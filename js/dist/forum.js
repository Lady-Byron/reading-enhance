(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.reg.get("core","forum/app");var n=t.n(e);const r=flarum.reg.get("core","common/extend"),o=flarum.reg.get("core","forum/components/DiscussionPage");var i=t.n(o);const s=flarum.reg.get("core","forum/components/PostStream");var a=t.n(s);function u(){const t=m.route.param&&m.route.param("near")||null,e="undefined"!=typeof window&&window.location.hash||"";return!!t||/^#p\d+$/i.test(e)}n().initializers.add("lady-byron/reading-enhance",()=>{(0,r.extend)(i().prototype,"oncreate",function(){if(!n().session.user)return;const t=this.discussion;if(!t)return;const e=t.attribute("lbReadingPosition")||null;!u()&&e&&this.stream&&requestAnimationFrame(()=>{this.stream.goToNumber(e)})}),(0,r.override)(i().prototype,"view",function(t){for(var e=this,r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];const s=t(...o),c=t=>{if(t){if(Array.isArray(t))return t.forEach(c);if(t.children&&c(t.children),t.tag===a()){t.attrs=t.attrs||{};const r=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof r&&r(...arguments),!n().session.user)return;const t=null==e?void 0:e.discussion;if(!t)return;let o=null;var i,s;o=function(){const t=document.querySelectorAll(".PostStream-item[data-number]");for(const e of Array.from(t)){const t=e.getBoundingClientRect();if(t.top>=0&&t.bottom<=(window.innerHeight||0)){const t=parseInt(e.dataset.number||"",10);if(t>0)return t}}return null}(),o&&"number"==typeof o&&(i=t.id(),s=o,n().request({method:"POST",url:"".concat(n().forum.attribute("apiUrl"),"/discussions/").concat(i,"/reading-position"),body:{postNumber:s}}).catch(()=>{})).then(()=>{t.attribute("lbReadingPosition")!==o&&t.pushAttributes({lbReadingPosition:o})})};const o=this.discussion,i=(null==o?void 0:o.attribute("lbReadingPosition"))||null;!u()&&i&&(t.attrs.targetPost=i)}}};return c(s),s})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map