/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),i=r(996),u=r(312),a=r(166),l=r(766),s=r(760);function c(){"use strict";var e=o(),r=e.m(c),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var d={throw:1,return:2,break:3,continue:3};function v(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,d[t],e)},delegateYield:function(t,o,i){return e.resultName=o,r(n.d,s(t),i)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,o){return e.w(v(t),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:a,async:function(t,e,r,n,o){return(p(e)?u:i)(v(t),e,r,n,o)},keys:l,values:s}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function l(t,o,i,u){var a=o&&o.prototype instanceof c?o:c,l=Object.create(a.prototype);return n(l,"_invoke",function(t,n,o){var i,u,a,l=0,c=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return i=t,u=0,a=e,p.n=r,s}};function d(t,n){for(u=t,a=n,r=0;!f&&l&&!o&&r<c.length;r++){var o,i=c[r],d=p.p,v=i[2];t>3?(o=v===n)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=t<2&&d<i[1])?(u=0,p.v=n,p.n=i[1]):d<v&&(o=t<3||i[0]>n||n>v)&&(i[4]=t,i[5]=n,p.n=v,u=0))}if(o||t>1)return s;throw f=!0,n}return function(o,c,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===c&&d(c,v),u=c,a=v;(r=u<2?e:a)||!f;){i||(u?u<3?(u>1&&(p.n=-1),d(u,a)):p.n=a:p.v=a);try{if(l=2,i){if(u||(o="next"),r=i[o]){if(!(r=r.call(i,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,u<2&&(u=0)}else 1===u&&(r=i.return)&&r.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((r=(f=p.n<0)?a:t.call(n,p))!==s)break}catch(t){i=e,u=1,a=t}finally{l=1}}return{value:r,done:f}}}(t,i,u),!0),l}var s={};function c(){}function f(){}function p(){}r=Object.getPrototypeOf;var d=[][u]?r(r([][u]())):(n(r={},u,function(){return this}),r),v=p.prototype=c.prototype=Object.create(d);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,n(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t}return f.prototype=p,n(v,"constructor",p),n(p,"constructor",f),f.displayName="GeneratorFunction",n(p,a,"GeneratorFunction"),n(v),n(v,a,"Generator"),n(v,u,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:l,m}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function i(t,o,u,a){try{var l=e[t](o),s=l.value;return s instanceof n?r.resolve(s.v).then(function(t){i("next",t,u,a)},function(t){i("throw",t,u,a)}):r.resolve(s).then(function(t){l.value=t,u(l)},function(t){return i("throw",t,u,a)})}catch(t){a(t)}}var u;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){i(t,n,e,r)})}return u=u?u.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,i,u){return new o(n().w(t,e,r,i),u||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,i){var u=Object.defineProperty;try{u({},"",{})}catch(r){u=0}t.exports=e=function(t,r,n,o){function i(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?u?u(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(i("next",0),i("throw",1),i("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,i){var u=n(t,e,r,o,i);return u.next().then(function(t){return t.done?t.value:u.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e,r,n,o,i,u){try{var a=t[i](u),l=a.value}catch(t){return void r(t)}a.done?e(l):Promise.resolve(l).then(n,o)}function e(e){return function(){var r=this,n=arguments;return new Promise(function(o,i){var u=e.apply(r,n);function a(e){t(u,o,i,a,l,"next",e)}function l(e){t(u,o,i,a,l,"throw",e)}a(void 0)})}}var n=r(183),o=r.n(n);const i=flarum.core.compat["forum/app"];var u=r.n(i);const a=flarum.core.compat["common/extend"],l=flarum.core.compat["forum/components/DiscussionListItem"];var s=r.n(l);const c=flarum.core.compat["forum/components/DiscussionPage"];var f=r.n(c);const p=flarum.core.compat["forum/components/PostStream"];var d=r.n(p);const v=flarum.core.compat["common/components/Link"];var b=r.n(v);const h=flarum.core.compat["forum/states/PostStreamState"];var y=r.n(h),x={did:null,targetNum:null,left:0,expiresAt:0};function g(){return Date.now()}function w(t){return!!t&&x.did===t&&x.left>0&&g()<x.expiresAt}function N(){x.left>0&&(x.left-=1),x.left<=0&&(x.did=null,x.targetNum=null,x.expiresAt=0)}function _(t,e){if(!t)return!1;if("reply"===e)return!0;var r="function"==typeof t.lastPostNumber?t.lastPostNumber():null==t.attribute?void 0:t.attribute("lastPostNumber");if("number"==typeof e&&e>0){if("number"==typeof r&&r>0&&e>=r)return!0;if(x.targetNum&&e>=x.targetNum)return!0}return!1}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}u().initializers.add("lady-byron/reading-enhance-reply-jump",function(){(function(){if(!u().__lbReqHooked){u().__lbReqHooked=!0;var t=u().request.bind(u());u().request=function(e){var r=t(e);try{var n=String((null==e?void 0:e.method)||"").toUpperCase(),o=String((null==e?void 0:e.url)||"");return"POST"===n&&/\/posts(?:\?|$|\/)/.test(o)?r.then(function(t){var e,r,n,o,i,u=null!=(e=null!=(r=null==t||null==(n=t.data)||null==(n=n.relationships)||null==(n=n.discussion)||null==(n=n.data)?void 0:n.id)?r:null==t||null==(o=t.data)||null==(o=o.attributes)?void 0:o.discussionId)?e:null,a="number"==typeof(null==t||null==(i=t.data)||null==(i=i.attributes)?void 0:i.number)?t.data.attributes.number:null;return u&&function(t,e,r,n){void 0===r&&(r=1800),void 0===n&&(n=3),x.did=t,x.targetNum="number"==typeof e&&e>0?e:null,x.left=Math.max(1,n),x.expiresAt=g()+Math.max(300,r)}(String(u),a,1800,3),t}):r}catch(t){return r}}}})(),function(){var t=y().prototype.goToNumber;y().prototype.goToNumber=function(e){try{var r,n=null==this?void 0:this.discussion;if(w(null!=(r=null==n||null==n.id?void 0:n.id())?r:"function"==typeof(null==n?void 0:n.id)?n.id():null)&&_(n,e))return void N()}catch(t){}for(var o=arguments.length,i=new Array(o>1?o-1:0),u=1;u<o;u++)i[u-1]=arguments[u];return t.apply(this,[e].concat(i))};var e=d().prototype;if("function"==typeof e.triggerScroll){var r=e.triggerScroll;e.triggerScroll=function(){try{var t,e,n,o,i,u=null==this||null==(t=this.attrs)?void 0:t.state,a=null==u?void 0:u.discussion,l=null!=(e=null==a||null==a.id?void 0:a.id())?e:"function"==typeof(null==a?void 0:a.id)?a.id():null,s=null!=(n=null!=(o=null!=(i=null==u?void 0:u.targetPostNumber)?i:null==u?void 0:u.index)?o:(null==u?void 0:u.visible)&&u.visible.number)?n:null;if(w(l)&&_(a,s))return void N()}catch(t){}for(var c=arguments.length,f=new Array(c),p=0;p<c;p++)f[p]=arguments[p];return r.apply(this,f)}}if("function"==typeof e.scrollToNumber){var n=e.scrollToNumber;e.scrollToNumber=function(t){try{var e,r,o=null==this||null==(e=this.attrs)?void 0:e.state,i=null==o?void 0:o.discussion;if(w(null!=(r=null==i||null==i.id?void 0:i.id())?r:"function"==typeof(null==i?void 0:i.id)?i.id():null)&&_(i,t))return void N()}catch(t){}for(var u=arguments.length,a=new Array(u>1?u-1:0),l=1;l<u;l++)a[l-1]=arguments[l];return n.apply(this,[t].concat(a))}}if("function"==typeof e.scrollToIndex){var o=e.scrollToIndex;e.scrollToIndex=function(t){try{var e,r,n,i=null==this||null==(e=this.attrs)?void 0:e.state,u=null==i?void 0:i.discussion,a=null!=(r=null==u||null==u.id?void 0:u.id())?r:"function"==typeof(null==u?void 0:u.id)?u.id():null,l=null!=i&&null!=(n=i.visible)&&n.number&&"number"==typeof i.visible.number?i.visible.number:t;if(w(a)&&_(u,l))return void N()}catch(t){}for(var s=arguments.length,c=new Array(s>1?s-1:0),f=1;f<s;f++)c[f-1]=arguments[f];return o.apply(this,[t].concat(c))}}}()});var S=Object.create(null),O=Object.create(null),R=Object.create(null);u().initializers.add("lady-byron/reading-enhance",function(){(0,a.extend)(s().prototype,"view",function(t){var e,r,n;if(null==(e=this.attrs)||null==(e=e.params)||!e.q){var o=null==(r=this.attrs)?void 0:r.discussion;if(o){var i=null!=(n=o.attribute("lbReadingPosition"))?n:null;!i||i<=1||t.children.forEach(function(t){t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.forEach(function(t){var e;t&&t.tag===b()&&(e=function(t){if(!("v17development-blog"in flarum.extensions))return!1;var e=u().forum.attribute("blogRedirectsEnabled"),r="both"===e||"discussions_only"===e,n=(null==t.tags?void 0:t.tags())||[];if(!r||0===n.length)return!1;var o=u().forum.attribute("blogTags")||[];return n.some(function(t){if(!t)return!1;var e=(null==t.parent?void 0:t.parent())||null;return-1!==o.indexOf(null==t.id?void 0:t.id())||e&&-1!==o.indexOf(null==e.id?void 0:e.id())})}(o)?i>1?u().route("blogArticle.near",{id:o.slug(),near:i}):u().route("blogArticle",{id:o.slug()}):u().route.discussion(o,i),t.attrs.href=e)})})}}}),(0,a.override)(f().prototype,"view",function(t){for(var e=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var i=t.apply(void 0,n),a=function(t){if(t){if(Array.isArray(t))return t.forEach(a);if(t.children&&a(t.children),t.tag===d()){t.attrs=t.attrs||{};var r=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if("function"==typeof r&&r.apply(void 0,n),u().session.user){var i=null==e?void 0:e.discussion;if(i){var a=function(t){for(var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return P(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);!(e=r()).done;){var n=e.value;if(null!=n)if("number"==typeof n){if(n>0)return n}else if("object"==typeof n){if("number"==typeof n.number&&n.number>0)return n.number;if("number"==typeof n.postNumber&&n.postNumber>0)return n.postNumber;if("number"==typeof n.near&&n.near>0)return n.near;if(n.visible&&"number"==typeof n.visible.number&&n.visible.number>0)return n.visible.number}}return null}(n);a||(a=function(){try{var t=new URL(window.location.href),e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1!==r&&e.length>r+2){var n=parseInt(e[r+2],10);if(!Number.isNaN(n)&&n>0)return n}var o=parseInt(t.searchParams.get("near")||"",10);if(!Number.isNaN(o)&&o>0)return o}catch(t){}return null}()),a||(a=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),e=0,r=Array.from(t);e<r.length;e++){var n=r[e],o=n.getBoundingClientRect();if(o.top<=4&&o.bottom>4){var i=parseInt(n.dataset.number||"",10);if(i>0)return i}}for(var u=0,a=Array.from(t);u<a.length;u++){var l=a[u],s=l.getBoundingClientRect();if(s.top>=4&&s.top<(window.innerHeight||0)){var c=parseInt(l.dataset.number||"",10);if(c>0)return c}}return null}()),a&&"number"==typeof a&&a>0&&function(t,e){var r=t.id();O[r]!==e&&(O[r]=e,S[r]&&window.clearTimeout(S[r]),S[r]=window.setTimeout(function(){var e,n,o=O[r];if(!("number"!=typeof o||o<=0)){var i,a,l=null!=(e=t.attribute("lbReadingPosition"))?e:0,s=null!=(n=R[r])?n:l;o!==l&&o!==s&&(i=r,a=o,u().request({method:"POST",url:u().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:i,postNumber:a}}).catch(function(){})).then(function(){R[r]=o,t.attribute("lbReadingPosition")!==o&&t.pushAttributes({lbReadingPosition:o})})}},200))}(i,a)}}}}}};return a(i),i});var t=new Map;function r(t){try{var e=new URL(u().forum.attribute("baseUrl"));return t.origin===e.origin}catch(t){return!1}}function n(t){var e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1===r||e.length<=r+1)return null;var n=e[r+1],o=/^(\d+)/.exec(n);return o?o[1]:null}function i(t){var e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1!==r&&e.length>r+2){var n=parseInt(e[r+2],10);if(!Number.isNaN(n)&&n>0)return n}var o=parseInt(t.searchParams.get("near")||"",10);if(!Number.isNaN(o)&&o>0)return o;if(t.hash&&/^#p\d+$/i.test(t.hash)){var i=parseInt(t.hash.slice(2),10);if(!Number.isNaN(i)&&i>0)return i}return null}function l(t,e){var r=t.pathname.split("/").filter(Boolean),n=r.indexOf("d"),o="/"+r.slice(0,n+2).join("/");return t.pathname=o+"/"+e,t.searchParams.delete("near"),t.hash&&/^#p\d+$/i.test(t.hash)&&(t.hash=""),t.pathname+t.search+t.hash}function c(t){var e=u().store.getById("discussions",t);if(!e)return null;var r=e.attribute&&e.attribute("lbReadingPosition"),n="function"==typeof e.lastReadPostNumber?e.lastReadPostNumber():e.attribute&&e.attribute("lastReadPostNumber");return"number"==typeof r&&r>1?r:"number"==typeof n&&n>1?n:null}function p(t){return v.apply(this,arguments)}function v(){return(v=e(o().mark(function t(e){var r,n,i,a,l;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,u().request({method:"GET",url:u().forum.attribute("apiUrl")+"/discussions/"+e,params:{"fields[discussions]":"title,slug,lastReadPostNumber,lbReadingPosition"}});case 1:return n=t.sent,i=(null==n||null==(r=n.data)?void 0:r.attributes)||{},a="number"==typeof i.lbReadingPosition?i.lbReadingPosition:null,l="number"==typeof i.lastReadPostNumber?i.lastReadPostNumber:null,t.abrupt("return",a&&a>1?a:l&&l>1?l:null);case 2:return t.prev=2,t.catch(0),t.abrupt("return",null);case 3:case"end":return t.stop()}},t,null,[[0,2]])}))).apply(this,arguments)}var h=new WeakMap;function y(t){for(var e=t;e&&e!==document.body;){if(e instanceof HTMLAnchorElement)return e;e=e.parentElement}return null}document.addEventListener("mouseover",function(u){var a=y(u.target);if(a){var s=window.setTimeout(e(o().mark(function e(){var u,s,f,d;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r(s=new URL(a.href,window.location.href))){e.next=1;break}return e.abrupt("return");case 1:if(!i(s)){e.next=2;break}return e.abrupt("return");case 2:if(f=n(s)){e.next=3;break}return e.abrupt("return");case 3:if(d=null!=(u=t.get(f))?u:c(f)){e.next=5;break}return e.next=4,p(f);case 4:(d=e.sent)&&t.set(f,d);case 5:d&&d>1&&(a.dataset.lbRewrittenNear?parseInt(a.dataset.lbRewrittenNear,10):null)!==d&&(a.href=l(s,d),a.dataset.lbRewritten="1",a.dataset.lbRewrittenNear=String(d)),e.next=7;break;case 6:e.prev=6,e.catch(0);case 7:case"end":return e.stop()}},e,null,[[0,6]])})),120);h.set(a,s)}},{passive:!0}),document.addEventListener("mouseout",function(t){var e=y(t.target);if(e){var r=h.get(e);r&&(window.clearTimeout(r),h.delete(e))}},{passive:!0}),document.addEventListener("click",function(u){var a=y(u.target);if(a){var s;try{s=new URL(a.href,window.location.href)}catch(t){return}if(r(s)){var f=n(s);f&&(u.preventDefault(),u.stopImmediatePropagation&&u.stopImmediatePropagation(),e(o().mark(function e(){var r,n,u;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=i(s))||(n=null!=(r=t.get(f))?r:c(f)),n){e.next=2;break}return e.next=1,p(f);case 1:(n=e.sent)&&t.set(f,n);case 2:return u=n&&n>1?l(s,n):s.pathname+s.search+s.hash,e.abrupt("return",m.route.set(u));case 3:case"end":return e.stop()}},e)}))().catch(function(){m.route.set(a.getAttribute("href"))}))}}},{capture:!0});var x=m.route.set.bind(m.route);m.route.set=function(t,e,r){try{var n=new URL(t,window.location.origin),o=n.pathname.split("/").filter(Boolean),i=o.indexOf("d");if(-1!==i&&o.length>i+1){var u=o.length>i+2&&/^\d+$/.test(o[i+2]),a=n.searchParams.has("near");if(!u&&!a){var l=o[i+1],s=/^(\d+)/.exec(l),f=s?s[1]:null;if(f){var p=c(f);if(p&&p>1){var d="/"+o.slice(0,i+2).join("/");n.pathname=d+"/"+p,n.searchParams.delete("near"),t=n.pathname+n.search+n.hash}}}}}catch(t){}return x(t,e,r)}})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map