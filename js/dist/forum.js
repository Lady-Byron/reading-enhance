(()=>{var t={858:t=>{"use strict";if(void 0===flarum.core.compat["forum/components/DiscussionSearchResult"]){var r=new Error("Cannot find module 'flarum.core.compat['forum/components/DiscussionSearchResult']'");throw r.code="MODULE_NOT_FOUND",r}t.exports=flarum.core.compat["forum/components/DiscussionSearchResult"]}},r={};function n(o){var e=r[o];if(void 0!==e)return e.exports;var i=r[o]={exports:{}};return t[o](i,i.exports,n),i.exports}n.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return n.d(r,{a:r}),r},n.d=(t,r)=>{for(var o in r)n.o(r,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},n.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var r=n.n(t);const o=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/DiscussionListItem"];var i=n.n(e);const a=flarum.core.compat["forum/components/DiscussionPage"];var s=n.n(a);const u=flarum.core.compat["forum/components/PostStream"];var l=n.n(u);const c=flarum.core.compat["common/components/Link"];var f=n.n(c),d=null;try{d=n(858).default}catch(t){}function p(t){return/[?&]near=\d+/.test(t)||/\/d\/[^/]+\/\d+(?:[/?#]|$)/.test(t)||/#p\d+/.test(t)}function v(t,n){var o=n&&n>1?n:0;return function(t){if(!("v17development-blog"in flarum.extensions))return!1;var n=r().forum.attribute("blogRedirectsEnabled"),o="both"===n||"discussions_only"===n,e=(null==t.tags?void 0:t.tags())||[];if(!o||0===e.length)return!1;var i=r().forum.attribute("blogTags")||[];return e.some(function(t){if(!t)return!1;var r=(null==t.parent?void 0:t.parent())||null;return-1!==i.indexOf(null==t.id?void 0:t.id())||r&&-1!==i.indexOf(null==r.id?void 0:r.id())})}(t)?o>1?r().route("blogArticle.near",{id:t.slug(),near:o}):r().route("blogArticle",{id:t.slug()}):r().route.discussion(t,o)}r().initializers.add("lady-byron/reading-enhance",function(){(0,o.extend)(i().prototype,"view",function(t){var r,n,o=null==(r=this.attrs)?void 0:r.discussion;if(o){var e=null!=(n=o.attribute("lbReadingPosition"))?n:null;t.children.forEach(function(t){var r;t&&null!=(r=t.attrs)&&r.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.forEach(function(t){var r;t&&t.tag===f()&&(null!=(r=t.attrs)&&r.href&&p(t.attrs.href)||(t.attrs.href=v(o,e)))})})}}),d&&d.prototype&&(0,o.extend)(d.prototype,"view",function(t){var r,n,o=null==(r=this.attrs)?void 0:r.discussion;if(o){var e=null!=(n=o.attribute("lbReadingPosition"))?n:null;t.children.forEach(function(t){var r;t&&t.tag===f()&&(null!=(r=t.attrs)&&r.href&&p(t.attrs.href)||(t.attrs.href=v(o,e)))})}}),(0,o.extend)(s().prototype,"show",function(t,r){var n;if(r){var o=m.route.get();if(!p(o)){var e=null!=(n=r.attribute("lbReadingPosition"))?n:null,i=v(r,e);o!==i&&m.route.set(i,void 0,{replace:!0})}}}),(0,o.override)(s().prototype,"view",function(t){for(var n=this,o=arguments.length,e=new Array(o>1?o-1:0),i=1;i<o;i++)e[i-1]=arguments[i];var a=t.apply(void 0,e),s=function(t){if(t){if(Array.isArray(t))return t.forEach(s);if(t.children&&s(t.children),t.tag===l()){t.attrs=t.attrs||{};var o=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof o&&o.apply(void 0,arguments),r().session.user){var t=null==n?void 0:n.discussion;if(t){var e,i,a=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,n=Array.from(t);r<n.length;r++){var o=n[r],e=o.getBoundingClientRect();if(e.top>=0&&e.bottom<=(window.innerHeight||0)){var i=parseInt(o.dataset.number||"",10);if(i>0)return i}}return null}();a&&"number"==typeof a&&(e=t.id(),i=a,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:e,postNumber:i}}).catch(function(){})).then(function(){t.attribute("lbReadingPosition")!==a&&t.pushAttributes({lbReadingPosition:a})})}}}}}};return s(a),a})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map