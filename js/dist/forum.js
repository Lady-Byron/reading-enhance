/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,r,e)=>{var n=e(163),o=e(110),u=e(996),a=e(312),i=e(166),s=e(766),c=e(760);function l(){"use strict";var r=o(),e=r.m(l),f=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function p(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===f||"GeneratorFunction"===(r.displayName||r.name))}var d={throw:1,return:2,break:3,continue:3};function v(t){var r,e;return function(n){r||(r={stop:function(){return e(n.a,2)},catch:function(){return n.v},abrupt:function(t,r){return e(n.a,d[t],r)},delegateYield:function(t,o,u){return r.resultName=o,e(n.d,c(t),u)},finish:function(t){return e(n.f,t)}},e=function(t,e,o){n.p=r.prev,n.n=r.next;try{return t(e,o)}finally{r.next=n.n}}),r.resultName&&(r[r.resultName]=n.v,r.resultName=void 0),r.sent=n.v,r.next=n.n;try{return t.call(this,r)}finally{n.p=r.prev,n.n=r.next}}}return(t.exports=l=function(){return{wrap:function(t,e,n,o){return r.w(v(t),e,n,o&&o.reverse())},isGeneratorFunction:p,mark:r.m,awrap:function(t,r){return new n(t,r)},AsyncIterator:i,async:function(t,r,e,n,o){return(p(r)?a:u)(v(t),r,e,n,o)},keys:s,values:c}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,r,e)=>{var n=e(397);function o(){var r,e,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.toStringTag||"@@toStringTag";function s(t,o,u,a){var i=o&&o.prototype instanceof l?o:l,s=Object.create(i.prototype);return n(s,"_invoke",function(t,n,o){var u,a,i,s=0,l=o||[],f=!1,p={p:0,n:0,v:r,a:d,f:d.bind(r,4),d:function(t,e){return u=t,a=0,i=r,p.n=e,c}};function d(t,n){for(a=t,i=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,u=l[e],d=p.p,v=u[2];t>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=r):u[0]<=d&&((o=t<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=t<3||u[0]>n||n>v)&&(u[4]=t,u[5]=n,p.n=v,a=0))}if(o||t>1)return c;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),a=l,i=v;(e=a<2?r:i)||!f;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(s=2,u){if(a||(o="next"),e=u[o]){if(!(e=e.call(u,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,a<2&&(a=0)}else 1===a&&(e=u.return)&&e.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=r}else if((e=(f=p.n<0)?i:t.call(n,p))!==c)break}catch(t){u=r,a=1,i=t}finally{s=1}}return{value:e,done:f}}}(t,u,a),!0),s}var c={};function l(){}function f(){}function p(){}e=Object.getPrototypeOf;var d=[][a]?e(e([][a]())):(n(e={},a,function(){return this}),e),v=p.prototype=l.prototype=Object.create(d);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,n(t,i,"GeneratorFunction")),t.prototype=Object.create(v),t}return f.prototype=p,n(v,"constructor",p),n(p,"constructor",f),f.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,a,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m:y}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,r){this.v=t,this.k=r},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,r,e)=>{var n=e(163),o=e(397);t.exports=function t(r,e){function u(t,o,a,i){try{var s=r[t](o),c=s.value;return c instanceof n?e.resolve(c.v).then(function(t){u("next",t,a,i)},function(t){u("throw",t,a,i)}):e.resolve(c).then(function(t){s.value=t,a(s)},function(t){return u("throw",t,a,i)})}catch(t){i(t)}}var a;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,r,n){function o(){return new e(function(r,e){u(t,n,r,e)})}return a=a?a.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,r,e)=>{var n=e(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,r,e)=>{var n=e(110),o=e(166);t.exports=function(t,r,e,u,a){return new o(n().w(t,r,e,u),a||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function r(e,n,o,u){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t.exports=r=function(t,e,n,o){function u(e,n){r(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(u("next",0),u("throw",1),u("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,r(e,n,o,u)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function r(e){return t.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,r(e)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,r,e)=>{var n=e(735).default;t.exports=function(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],e=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var r=Object(t),e=[];for(var n in r)e.unshift(n);return function t(){for(;e.length;)if((n=e.pop())in r)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},858:t=>{"use strict";if(void 0===flarum.core.compat["forum/components/DiscussionSearchResult"]){var r=new Error("Cannot find module 'flarum.core.compat['forum/components/DiscussionSearchResult']'");throw r.code="MODULE_NOT_FOUND",r}t.exports=flarum.core.compat["forum/components/DiscussionSearchResult"]},996:(t,r,e)=>{var n=e(312);t.exports=function(t,r,e,o,u){var a=n(t,r,e,o,u);return a.next().then(function(t){return t.done?t.value:a.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},r={};function e(n){var o=r[n];if(void 0!==o)return o.exports;var u=r[n]={exports:{}};return t[n](u,u.exports,e),u.exports}e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";function t(t,r,e,n,o,u,a){try{var i=t[u](a),s=i.value}catch(t){return void e(t)}i.done?r(s):Promise.resolve(s).then(n,o)}function r(r){return function(){var e=this,n=arguments;return new Promise(function(o,u){var a=r.apply(e,n);function i(r){t(a,o,u,i,s,"next",r)}function s(r){t(a,o,u,i,s,"throw",r)}i(void 0)})}}var n=e(183),o=e.n(n);const u=flarum.core.compat["forum/app"];var a=e.n(u);const i=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/components/DiscussionListItem"];var c=e.n(s);const l=flarum.core.compat["forum/components/DiscussionPage"];var f=e.n(l);const p=flarum.core.compat["forum/components/PostStream"];var d=e.n(p);const v=flarum.core.compat["common/components/Link"];var y=e.n(v);function h(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}var x=null;try{x=e(858).default}catch(t){}function b(t){return/[?&]near=\d+/.test(t)||/\/d\/[^/]+\/\d+(?:[/?#]|$)/.test(t)||/#p\d+/.test(t)}function g(t,r){try{var e=new URL(t,window.location.origin);return e.searchParams.has("near")||e.searchParams.set("near",String(r)),e.pathname+e.search+e.hash}catch(e){return t+(t.includes("?")?"&":"?")+"near="+r}}function _(t){if(!t)return null;if(Array.isArray(t)){for(var r,e=function(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return h(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?h(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);!(r=e()).done;){var n=_(r.value);if(n)return n}return null}return t.tag===y()?t:t.children?_(t.children):null}function w(t){try{var r=new URL(t,window.location.origin).pathname.match(/\/d\/(\d+)/);return r?r[1]:null}catch(r){var e=t.match(/\/d\/(\d+)/);return e?e[1]:null}}var S=new Map;function P(t){return O.apply(this,arguments)}function O(){return(O=r(o().mark(function t(r){var e,n,u,i,s,c,l;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=w(r)){t.next=1;break}return t.abrupt("return",null);case 1:if(!S.has(n)){t.next=2;break}return t.abrupt("return",S.get(n));case 2:if(u=null==a().store.getById?void 0:a().store.getById("discussions",n),i=null!=(e=null==u||null==u.attribute?void 0:u.attribute("lbReadingPosition"))?e:null){t.next=6;break}return t.prev=3,t.next=4,a().request({method:"GET",url:a().forum.attribute("apiUrl")+"/discussions/"+n});case 4:l=t.sent,i=null!=(s=null==l||null==(c=l.data)||null==(c=c.attributes)?void 0:c.lbReadingPosition)?s:null,t.next=6;break;case 5:t.prev=5,t.catch(3),i=null;case 6:return i&&i>1&&S.set(n,i),t.abrupt("return",i&&i>1?i:null);case 7:case"end":return t.stop()}},t,null,[[3,5]])}))).apply(this,arguments)}a().initializers.add("lady-byron/reading-enhance",function(){(0,i.extend)(c().prototype,"view",function(t){var r,e,n,o=null==(r=this.attrs)?void 0:r.discussion;if(o){var u=null!=(e=o.attribute("lbReadingPosition"))?e:null;if(u&&!(u<=1)){var a=_(t);if(a&&null!=(n=a.attrs)&&n.href){var i=a.attrs.href;b(i)||(a.attrs.href=g(i,u))}}}}),x&&x.prototype&&(0,i.extend)(x.prototype,"view",function(t){var r,e,n,o=null==(r=this.attrs)?void 0:r.discussion;if(o){var u=null!=(e=o.attribute("lbReadingPosition"))?e:null;if(u&&!(u<=1)){var a=_(t);if(a&&null!=(n=a.attrs)&&n.href){var i=a.attrs.href;b(i)||(a.attrs.href=g(i,u))}}}}),(0,i.extend)(f().prototype,"show",function(t,r){var e;if(r){var n=m.route.get();if(!b(n)){var o=null!=(e=r.attribute("lbReadingPosition"))?e:null;if(o&&!(o<=1)){var u=g(a().route.discussion(r),o);n!==u&&m.route.set(u,void 0,{replace:!0})}}}}),(0,i.override)(f().prototype,"view",function(t){for(var r=this,e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var u=t.apply(void 0,n),i=function(t){if(t){if(Array.isArray(t))return t.forEach(i);if(t.children&&i(t.children),t.tag===d()){t.attrs=t.attrs||{};var e=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof e&&e.apply(void 0,arguments),a().session.user){var t=null==r?void 0:r.discussion;if(t){var n,o,u=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,e=Array.from(t);r<e.length;r++){var n=e[r],o=n.getBoundingClientRect();if(o.top>=0&&o.bottom<=(window.innerHeight||0)){var u=parseInt(n.dataset.number||"",10);if(u>0)return u}}return null}();u&&"number"==typeof u&&(n=t.id(),o=u,a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:n,postNumber:o}}).catch(function(){})).then(function(){t.attribute("lbReadingPosition")!==u&&t.pushAttributes({lbReadingPosition:u})})}}}}}};return i(u),u}),document.addEventListener("click",function(){var t=r(o().mark(function t(r){var e,n,u,a,i;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null==(e=r.target)||null==e.closest?void 0:e.closest("a")){t.next=1;break}return t.abrupt("return");case 1:if(!n.target||""===n.target||"_self"===n.target){t.next=2;break}return t.abrupt("return");case 2:if(!(r.metaKey||r.ctrlKey||r.shiftKey||r.altKey)){t.next=3;break}return t.abrupt("return");case 3:if(u=n.getAttribute("href")||"",/\/d\//.test(u)){t.next=4;break}return t.abrupt("return");case 4:if(!b(u)){t.next=5;break}return t.abrupt("return");case 5:return t.next=6,P(u);case 6:if(a=t.sent){t.next=7;break}return t.abrupt("return");case 7:r.preventDefault(),i=g(u,a),m.route.set(i);case 8:case"end":return t.stop()}},t)}));return function(r){return t.apply(this,arguments)}}(),{capture:!0})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map