(()=>{var t={n:r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},d:(r,n)=>{for(var o in n)t.o(n,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:n[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["forum/app"];var n=t.n(r);const o=flarum.core.compat["forum/components/DiscussionPage"];var e=t.n(o);const i=flarum.core.compat["forum/components/PostStream"];var a=t.n(i);const u=flarum.core.compat["common/extend"];function s(){var t=m.route.param&&m.route.param("near")||null,r="undefined"!=typeof window&&window.location.hash||"";return!!t||/^#p\d+$/i.test(r)}n().initializers.add("lady-byron/reading-enhance",function(){(0,u.extend)(e().prototype,"oncreate",function(){var t,r=this;if(n().session.user){var o=this.discussion,e=null!=(t=null==o?void 0:o.attribute("lbReadingPosition"))?t:null;!s()&&e&&this.stream&&requestAnimationFrame(function(){return r.stream.goToNumber(e)})}}),(0,u.override)(e().prototype,"view",function(t){for(var r=this,o=arguments.length,e=new Array(o>1?o-1:0),i=1;i<o;i++)e[i-1]=arguments[i];var u=t.apply(void 0,e),l=function(t){if(t){if(Array.isArray(t))return t.forEach(l);if(t.children&&l(t.children),t.tag===a()){var o;t.attrs=t.attrs||{};var e=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof e&&e.apply(void 0,arguments),n().session.user){var t=null==r?void 0:r.discussion;if(t){var o,i,a=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,n=Array.from(t);r<n.length;r++){var o=n[r],e=o.getBoundingClientRect();if(e.top>=0&&e.bottom<=(window.innerHeight||0)){var i=parseInt(o.dataset.number||"",10);if(i>0)return i}}return null}();a&&"number"==typeof a&&(o=t.id(),i=a,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:o,postNumber:i}}).catch(function(){})).then(function(){t.attribute("lbReadingPosition")!==a&&t.pushAttributes({lbReadingPosition:a})})}}};var i=r.discussion,u=null!=(o=null==i?void 0:i.attribute("lbReadingPosition"))?o:null;!s()&&u&&(t.attrs.targetPost=u)}}};return l(u),u})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map