(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var n=t.n(e);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/states/PostStreamState"];var i=t.n(o),u={did:null,targetNum:null,left:0,expiresAt:0};function a(t,e){"scrollBy"in window?window.scrollBy({top:t,left:0,behavior:e?"smooth":"auto"}):(document.scrollingElement||document.documentElement||document.body).scrollTop+=t}const l=flarum.core.compat["forum/components/DiscussionPage"];var s=t.n(l),d=Object.create(null),c=Object.create(null),f=Object.create(null),p=[];var m=!1;const v=flarum.core.compat["forum/components/DiscussionListItem"];var b,h,y=t.n(v),g=!1,w=!1;n().initializers.add("lady-byron/reading-enhance-reply-jump",function(){(function(){if(!n().__lbReqHooked){n().__lbReqHooked=!0;var t=n().request.bind(n());n().request=function(e){var n=t(e);try{var r=String((null==e?void 0:e.method)||"").toUpperCase(),o=String((null==e?void 0:e.url)||"");return"POST"===r&&/\/api\/posts(?:\?|$)/.test(o)?n.then(function(t){var e,n,r,o,i,a=null!=(e=null!=(n=null==t||null==(r=t.data)||null==(r=r.relationships)||null==(r=r.discussion)||null==(r=r.data)?void 0:r.id)?n:null==t||null==(o=t.data)||null==(o=o.attributes)?void 0:o.discussionId)?e:null,l="number"==typeof(null==t||null==(i=t.data)||null==(i=i.attributes)?void 0:i.number)?t.data.attributes.number:null;return a&&function(t,e,n,r){void 0===n&&(n=1800),void 0===r&&(r=3),u.did=t,u.targetNum="number"==typeof e&&e>0?e:null,u.left=Math.max(1,r),u.expiresAt=Date.now()+Math.max(300,n)}(String(a),l,1800,3),t}):n}catch(t){return n}}}})(),(0,r.override)(i().prototype,"goToNumber",function(t,e){try{var n=this.discussion;if((r="function"==typeof(null==n?void 0:n.id)?n.id():null==n?void 0:n.id)&&u.did===r&&u.left>0&&Date.now()<u.expiresAt&&function(t,e){if(!t)return!1;if("reply"===e)return!0;var n="function"==typeof t.lastPostNumber?t.lastPostNumber():null==t.attribute?void 0:t.attribute("lastPostNumber");if("number"==typeof e&&e>0){if("number"==typeof n&&n>0&&e>=n)return!0;if(u.targetNum&&e>=u.targetNum)return!0}return!1}(n,e))return u.left>0&&(u.left-=1),void(u.left<=0&&(u.did=null,u.targetNum=null,u.expiresAt=0))}catch(t){}for(var r,o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];return t.apply(void 0,[e].concat(i))})}),b=Object.assign({},{halfRatio:.5,smooth:!0,headerSelector:".App-header"},{}),h=!1,n().initializers.add("lady-byron/reading-enhance-shortcuts",function(){if(!h){h=!0;var t=function(t){if(!function(t){var e,r=t instanceof Element?t:null;if(!r)return!1;var o=r.closest('input, textarea, [contenteditable="true"], .TextEditor, .CodeMirror, .ProseMirror, .Composer, .Modal'),i=!(null==n()||null==(e=n().composer)||null==e.isVisible||!e.isVisible());return!!o||i}(t.target)&&!t.repeat){var e=function(t){if(t.ctrlKey||t.metaKey||t.altKey)return"";var e=[];t.shiftKey&&e.push("Shift");var n=1===t.key.length?t.key.toUpperCase():t.key;return e.push(n),e.join("+")}(t);if(e){var r=function(t){try{var e=document.querySelector(t);return e?e.getBoundingClientRect().height:0}catch(t){return 0}}(b.headerSelector),o=window.innerHeight||0;switch(e){case"Shift+D":t.preventDefault(),t.stopPropagation(),a(Math.max(1,Math.round(o*b.halfRatio)-Math.round(r/2)),b.smooth);break;case"Shift+U":t.preventDefault(),t.stopPropagation(),a(-Math.max(1,Math.round(o*b.halfRatio)-Math.round(r/2)),b.smooth);break;case"Shift+J":t.preventDefault(),t.stopPropagation(),a(Math.max(1,o-r),b.smooth);break;case"Shift+K":t.preventDefault(),t.stopPropagation(),a(-Math.max(1,o-r),b.smooth)}}}};window.addEventListener("keydown",t,!0),window.__lb_shortcuts={detach:function(){window.removeEventListener("keydown",t,!0)}}}}),m||(m=!0,n().initializers.add("lady-byron/reading-enhance-recorder",function(){(0,r.extend)(s().prototype,"positionChanged",function(t,e){if(n().session.user){var r=this.discussion;r&&"number"==typeof e&&e>0&&function(t,e){var r,o=null!=(r=null==t.id?void 0:t.id())?r:t.id;o&&(function(t){var e=p.indexOf(t);for(-1!==e&&p.splice(e,1),p.push(t);p.length>50;){var n=p.shift();d[n]&&window.clearTimeout(d[n]),delete d[n],delete c[n],delete f[n]}}(o),c[o]!==e&&(c[o]=e,d[o]&&window.clearTimeout(d[o]),d[o]=window.setTimeout(function(){var e,r,i=c[o];if(!("number"!=typeof i||i<=0)){var u,a,l=null!=(e=null==t.attribute?void 0:t.attribute("lbReadingPosition"))?e:0,s=null!=(r=f[o])?r:l;i!==l&&i!==s&&(u=o,a=i,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:u,postNumber:a}}).catch(function(){})).then(function(){f[o]=i,t.attribute&&t.attribute("lbReadingPosition")!==i&&t.pushAttributes({lbReadingPosition:i})})}},200)))}(r,e)}})})),w||(w=!0,n().initializers.add("lady-byron/reading-enhance-navigation",function(){if(n().route.discussion){var t=n().route.discussion.bind(n().route);n().route.discussion=function(e,r){try{if(g)return t(e,r);if(!r){var o="function"==typeof(null==e?void 0:e.id)?e.id():null==e?void 0:e.id;if(o){var i=function(t){var e=n().store.getById("discussions",t);if(!e)return null;var r="function"==typeof e.attribute?e.attribute("lbReadingPosition"):e.lbReadingPosition;if("number"==typeof r)return r>1?r:null;var o="function"==typeof e.lastReadPostNumber?e.lastReadPostNumber():"function"==typeof e.attribute?e.attribute("lastReadPostNumber"):null;return"number"==typeof o&&o>1?o:null}(String(o));if(i&&i>1&&function(t){try{if(!flarum||!("v17development-blog"in flarum.extensions))return!1}catch(t){return!1}var e=n().forum.attribute("blogRedirectsEnabled"),r="both"===e||"discussions_only"===e,o=(null==t.tags?void 0:t.tags())||[];if(!r||0===o.length)return!1;var i=n().forum.attribute("blogTags")||[];return o.some(function(t){var e,n,r,o;if(!t)return!1;var u=null!=(e=null!=(n=null==t.id?void 0:t.id())?n:t.id)?e:null,a=(null==t.parent?void 0:t.parent())||null,l=a&&null!=(r=null!=(o=null==a.id?void 0:a.id())?o:a.id)?r:null;return null!=u&&-1!==i.indexOf(u)||null!=l&&-1!==i.indexOf(l)})}(e))try{var u="function"==typeof e.slug?e.slug():e.slug;return n().route("blogArticle.near",{id:u,near:i})}catch(t){}i&&(r=i)}}}catch(t){}return t(e,r)},(0,r.override)(y().prototype,"view",function(t){var e;if(null!=(e=this.attrs)&&null!=(e=e.params)&&e.q){g=!0;try{return t()}finally{g=!1}}return t()})}}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map