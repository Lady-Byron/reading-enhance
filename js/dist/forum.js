(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["forum/app"];var e=t.n(r);const n=flarum.core.compat["forum/components/DiscussionPage"];var o=t.n(n);const i=flarum.core.compat["forum/components/PostStream"];var a=t.n(i);const s=flarum.core.compat["common/extend"];function u(){var t=m.route.param&&m.route.param("near")||null,r="undefined"!=typeof window&&window.location.hash||"";return!!t||/^#p\d+$/i.test(r)}e().initializers.add("lady-byron/reading-enhance",function(){(0,s.extend)(o().prototype,"oninit",function(){var t;if(e().session.user){var r=this.discussion,n=null!=(t=null==r?void 0:r.attribute("lbReadingPosition"))?t:null;!u()&&n&&this.stream&&(this.stream.targetPost={number:n},this.stream.needsScroll=!0)}}),(0,s.extend)(o().prototype,"oncreate",function(){var t;if(e().session.user){var r=this,n=r.discussion,o=null!=(t=null==n?void 0:n.attribute("lbReadingPosition"))?t:null;!u()&&o&&r.stream&&(r.stream.targetPost={number:o},r.stream.needsScroll=!0,r.stream.goToNumber(o,!0))}}),(0,s.override)(o().prototype,"view",function(t){for(var r=this,n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var s=t.apply(void 0,o),u=function(t){if(t){if(Array.isArray(t))return t.forEach(u);if(t.children&&u(t.children),t.tag===a()){t.attrs=t.attrs||{};var n=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof n&&n.apply(void 0,arguments),e().session.user){var t=null==r?void 0:r.discussion;if(t){var o,i,a=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,e=Array.from(t);r<e.length;r++){var n=e[r],o=n.getBoundingClientRect();if(o.top>=0&&o.bottom<=(window.innerHeight||0)){var i=parseInt(n.dataset.number||"",10);if(i>0)return i}}return null}();a&&"number"==typeof a&&(o=t.id(),i=a,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:o,postNumber:i}}).catch(function(){})).then(function(){t.attribute("lbReadingPosition")!==a&&t.pushAttributes({lbReadingPosition:a})})}}}}}};return u(s),s})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map