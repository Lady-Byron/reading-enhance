(()=>{var t={n:r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},d:(r,n)=>{for(var o in n)t.o(n,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:n[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["forum/app"];var n=t.n(r);const o=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/DiscussionPage"];var i=t.n(e);const a=flarum.core.compat["forum/components/PostStream"];var s=t.n(a);function u(){var t=m.route.param&&m.route.param("near")||null,r="undefined"!=typeof window&&window.location.hash||"";return!!t||/^#p\d+$/i.test(r)}n().initializers.add("lady-byron/reading-enhance",function(){(0,o.extend)(i().prototype,"oncreate",function(){var t=this;if(n().session.user){var r=this.discussion;if(r){var o=r.attribute("lbReadingPosition")||null;!u()&&o&&this.stream&&requestAnimationFrame(function(){t.stream.goToNumber(o)})}}}),(0,o.override)(i().prototype,"view",function(t){for(var r=this,o=arguments.length,e=new Array(o>1?o-1:0),i=1;i<o;i++)e[i-1]=arguments[i];var a=t.apply(void 0,e),c=function(t){if(t){if(Array.isArray(t))return t.forEach(c);if(t.children&&c(t.children),t.tag===s()){t.attrs=t.attrs||{};var o=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof o&&o.apply(void 0,arguments),n().session.user){var t,e,i,a=null==r?void 0:r.discussion;if(a)(t=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,n=Array.from(t);r<n.length;r++){var o=n[r],e=o.getBoundingClientRect();if(e.top>=0&&e.bottom<=(window.innerHeight||0)){var i=parseInt(o.dataset.number||"",10);if(i>0)return i}}return null}())&&"number"==typeof t&&(e=a.id(),i=t,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/discussions/"+e+"/reading-position",body:{postNumber:i}}).catch(function(){})).then(function(){a.attribute("lbReadingPosition")!==t&&a.pushAttributes({lbReadingPosition:t})})}};var e=r.discussion,i=(null==e?void 0:e.attribute("lbReadingPosition"))||null;!u()&&i&&(t.attrs.targetPost=i)}}};return c(a),a})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map