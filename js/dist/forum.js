/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),a=r(996),i=r(312),u=r(166),s=r(766),l=r(760);function c(){"use strict";var e=o(),r=e.m(c),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var d={throw:1,return:2,break:3,continue:3};function v(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,d[t],e)},delegateYield:function(t,o,a){return e.resultName=o,r(n.d,l(t),a)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,o){return e.w(v(t),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:u,async:function(t,e,r,n,o){return(p(e)?i:a)(v(t),e,r,n,o)},keys:s,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",u=a.toStringTag||"@@toStringTag";function s(t,o,a,i){var u=o&&o.prototype instanceof c?o:c,s=Object.create(u.prototype);return n(s,"_invoke",function(t,n,o){var a,i,u,s=0,c=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return a=t,i=0,u=e,p.n=r,l}};function d(t,n){for(i=t,u=n,r=0;!f&&s&&!o&&r<c.length;r++){var o,a=c[r],d=p.p,v=a[2];t>3?(o=v===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=t<2&&d<a[1])?(i=0,p.v=n,p.n=a[1]):d<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,p.n=v,i=0))}if(o||t>1)return l;throw f=!0,n}return function(o,c,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===c&&d(c,v),i=c,u=v;(r=i<2?e:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),d(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(f=p.n<0)?u:t.call(n,p))!==l)break}catch(t){a=e,i=1,u=t}finally{s=1}}return{value:r,done:f}}}(t,a,i),!0),s}var l={};function c(){}function f(){}function p(){}r=Object.getPrototypeOf;var d=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),v=p.prototype=c.prototype=Object.create(d);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,n(t,u,"GeneratorFunction")),t.prototype=Object.create(v),t}return f.prototype=p,n(v,"constructor",p),n(p,"constructor",f),f.displayName="GeneratorFunction",n(p,u,"GeneratorFunction"),n(v),n(v,u,"Generator"),n(v,i,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function a(t,o,i,u){try{var s=e[t](o),l=s.value;return l instanceof n?r.resolve(l.v).then(function(t){a("next",t,i,u)},function(t){a("throw",t,i,u)}):r.resolve(l).then(function(t){s.value=t,i(s)},function(t){return a("throw",t,i,u)})}catch(t){u(t)}}var i;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){a(t,n,e,r)})}return i=i?i.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,a,i){return new o(n().w(t,e,r,a),i||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,a){var i=Object.defineProperty;try{i({},"",{})}catch(r){i=0}t.exports=e=function(t,r,n,o){function a(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?i?i(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(a("next",0),a("throw",1),a("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,a)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,a){var i=n(t,e,r,o,a);return i.next().then(function(t){return t.done?t.value:i.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e,r,n,o,a,i){try{var u=t[a](i),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function e(e){return function(){var r=this,n=arguments;return new Promise(function(o,a){var i=e.apply(r,n);function u(e){t(i,o,a,u,s,"next",e)}function s(e){t(i,o,a,u,s,"throw",e)}u(void 0)})}}var n=r(183),o=r.n(n);const a=flarum.core.compat["forum/app"];var i=r.n(a);const u=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/components/DiscussionListItem"];var l=r.n(s);const c=flarum.core.compat["forum/components/DiscussionPage"];var f=r.n(c);const p=flarum.core.compat["forum/components/PostStream"];var d=r.n(p);const v=flarum.core.compat["common/components/Link"];var b=r.n(v);function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var y=Object.create(null),x=Object.create(null),g=Object.create(null);i().initializers.add("lady-byron/reading-enhance",function(){(0,u.extend)(l().prototype,"view",function(t){var e,r,n;if(null==(e=this.attrs)||null==(e=e.params)||!e.q){var o=null==(r=this.attrs)?void 0:r.discussion;if(o){var a=null!=(n=o.attribute("lbReadingPosition"))?n:null;!a||a<=1||t.children.forEach(function(t){t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.forEach(function(t){var e;t&&t.tag===b()&&(e=function(t){if(!("v17development-blog"in flarum.extensions))return!1;var e=i().forum.attribute("blogRedirectsEnabled"),r="both"===e||"discussions_only"===e,n=(null==t.tags?void 0:t.tags())||[];if(!r||0===n.length)return!1;var o=i().forum.attribute("blogTags")||[];return n.some(function(t){if(!t)return!1;var e=(null==t.parent?void 0:t.parent())||null;return-1!==o.indexOf(null==t.id?void 0:t.id())||e&&-1!==o.indexOf(null==e.id?void 0:e.id())})}(o)?a>1?i().route("blogArticle.near",{id:o.slug(),near:a}):i().route("blogArticle",{id:o.slug()}):i().route.discussion(o,a),t.attrs.href=e)})})}}}),(0,u.override)(f().prototype,"view",function(t){for(var e=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var a=t.apply(void 0,n),u=function(t){if(t){if(Array.isArray(t))return t.forEach(u);if(t.children&&u(t.children),t.tag===d()){t.attrs=t.attrs||{};var r=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if("function"==typeof r&&r.apply(void 0,n),i().session.user){var a=null==e?void 0:e.discussion;if(a){var u=function(t){for(var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return h(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);!(e=r()).done;){var n=e.value;if(null!=n)if("number"==typeof n){if(n>0)return n}else if("object"==typeof n){if("number"==typeof n.number&&n.number>0)return n.number;if("number"==typeof n.postNumber&&n.postNumber>0)return n.postNumber;if("number"==typeof n.near&&n.near>0)return n.near;if(n.visible&&"number"==typeof n.visible.number&&n.visible.number>0)return n.visible.number}}return null}(n);u||(u=function(){try{var t=new URL(window.location.href),e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1!==r&&e.length>r+2){var n=parseInt(e[r+2],10);if(!Number.isNaN(n)&&n>0)return n}var o=parseInt(t.searchParams.get("near")||"",10);if(!Number.isNaN(o)&&o>0)return o}catch(t){}return null}()),u||(u=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),e=0,r=Array.from(t);e<r.length;e++){var n=r[e],o=n.getBoundingClientRect();if(o.top<=4&&o.bottom>4){var a=parseInt(n.dataset.number||"",10);if(a>0)return a}}for(var i=0,u=Array.from(t);i<u.length;i++){var s=u[i],l=s.getBoundingClientRect();if(l.top>=4&&l.top<(window.innerHeight||0)){var c=parseInt(s.dataset.number||"",10);if(c>0)return c}}return null}()),u&&"number"==typeof u&&u>0&&function(t,e){var r=t.id();x[r]!==e&&(x[r]=e,y[r]&&window.clearTimeout(y[r]),y[r]=window.setTimeout(function(){var e,n,o=x[r];if(!("number"!=typeof o||o<=0)){var a,u,s=null!=(e=t.attribute("lbReadingPosition"))?e:0,l=null!=(n=g[r])?n:s;o!==s&&o!==l&&(a=r,u=o,i().request({method:"POST",url:i().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:a,postNumber:u}}).catch(function(){})).then(function(){g[r]=o,t.attribute("lbReadingPosition")!==o&&t.pushAttributes({lbReadingPosition:o})})}},200))}(a,u)}}}}}};return u(a),a});var t=new Map;function r(t){try{var e=new URL(i().forum.attribute("baseUrl"));return t.origin===e.origin}catch(t){return!1}}function n(t){var e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1===r||e.length<=r+1)return null;var n=e[r+1],o=/^(\d+)/.exec(n);return o?o[1]:null}function a(t){var e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1!==r&&e.length>r+2){var n=parseInt(e[r+2],10);if(!Number.isNaN(n)&&n>0)return n}var o=parseInt(t.searchParams.get("near")||"",10);if(!Number.isNaN(o)&&o>0)return o;if(t.hash&&/^#p\d+$/i.test(t.hash)){var a=parseInt(t.hash.slice(2),10);if(!Number.isNaN(a)&&a>0)return a}return null}function s(t,e){var r=t.pathname.split("/").filter(Boolean),n=r.indexOf("d"),o="/"+r.slice(0,n+2).join("/");return t.pathname=o+"/"+e,t.searchParams.delete("near"),t.hash&&/^#p\d+$/i.test(t.hash)&&(t.hash=""),t.pathname+t.search+t.hash}function c(t){var e=i().store.getById("discussions",t);if(!e)return null;var r=e.attribute&&e.attribute("lbReadingPosition"),n="function"==typeof e.lastReadPostNumber?e.lastReadPostNumber():e.attribute&&e.attribute("lastReadPostNumber");return"number"==typeof r&&r>1?r:"number"==typeof n&&n>1?n:null}function p(t){return v.apply(this,arguments)}function v(){return(v=e(o().mark(function t(e){var r,n,a,u,s;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,i().request({method:"GET",url:i().forum.attribute("apiUrl")+"/discussions/"+e,params:{"fields[discussions]":"title,slug,lastReadPostNumber,lbReadingPosition"}});case 1:return n=t.sent,a=(null==n||null==(r=n.data)?void 0:r.attributes)||{},u="number"==typeof a.lbReadingPosition?a.lbReadingPosition:null,s="number"==typeof a.lastReadPostNumber?a.lastReadPostNumber:null,t.abrupt("return",u&&u>1?u:s&&s>1?s:null);case 2:return t.prev=2,t.catch(0),t.abrupt("return",null);case 3:case"end":return t.stop()}},t,null,[[0,2]])}))).apply(this,arguments)}var w=new WeakMap;function _(t){for(var e=t;e&&e!==document.body;){if(e instanceof HTMLAnchorElement)return e;e=e.parentElement}return null}document.addEventListener("mouseover",function(i){var u=_(i.target);if(u){var l=window.setTimeout(e(o().mark(function e(){var i,l,f,d;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r(l=new URL(u.href,window.location.href))){e.next=1;break}return e.abrupt("return");case 1:if(!a(l)){e.next=2;break}return e.abrupt("return");case 2:if(f=n(l)){e.next=3;break}return e.abrupt("return");case 3:if(d=null!=(i=t.get(f))?i:c(f)){e.next=5;break}return e.next=4,p(f);case 4:(d=e.sent)&&t.set(f,d);case 5:d&&d>1&&(u.dataset.lbRewrittenNear?parseInt(u.dataset.lbRewrittenNear,10):null)!==d&&(u.href=s(l,d),u.dataset.lbRewritten="1",u.dataset.lbRewrittenNear=String(d)),e.next=7;break;case 6:e.prev=6,e.catch(0);case 7:case"end":return e.stop()}},e,null,[[0,6]])})),120);w.set(u,l)}},{passive:!0}),document.addEventListener("mouseout",function(t){var e=_(t.target);if(e){var r=w.get(e);r&&(window.clearTimeout(r),w.delete(e))}},{passive:!0}),document.addEventListener("click",function(i){var u=_(i.target);if(u){var l;try{l=new URL(u.href,window.location.href)}catch(t){return}if(r(l)){var f=n(l);f&&(i.preventDefault(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),e(o().mark(function e(){var r,n,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a(l))||(n=null!=(r=t.get(f))?r:c(f)),n){e.next=2;break}return e.next=1,p(f);case 1:(n=e.sent)&&t.set(f,n);case 2:return i=n&&n>1?s(l,n):l.pathname+l.search+l.hash,e.abrupt("return",m.route.set(i));case 3:case"end":return e.stop()}},e)}))().catch(function(){m.route.set(u.getAttribute("href"))}))}}},{capture:!0});var N=m.route.set.bind(m.route);m.route.set=function(t,e,r){try{var n=new URL(t,window.location.origin),o=n.pathname.split("/").filter(Boolean),a=o.indexOf("d");if(-1!==a&&o.length>a+1){var i=o.length>a+2&&/^\d+$/.test(o[a+2]),u=n.searchParams.has("near");if(!i&&!u){var s=o[a+1],l=/^(\d+)/.exec(s),f=l?l[1]:null;if(f){var p=c(f);if(p&&p>1){var d="/"+o.slice(0,a+2).join("/");n.pathname=d+"/"+p,n.searchParams.delete("near"),t=n.pathname+n.search+n.hash}}}}}catch(t){}return N(t,e,r)}})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map