(()=>{var r={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},d:(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},o:(r,t)=>Object.prototype.hasOwnProperty.call(r,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=r.n(t);const e=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionListItem"];var a=r.n(o);const i=flarum.core.compat["forum/components/DiscussionPage"];var u=r.n(i);const s=flarum.core.compat["forum/components/PostStream"];var l=r.n(s);const c=flarum.core.compat["common/components/Link"];var f=r.n(c);function m(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=Array(t);n<t;n++)e[n]=r[n];return e}function d(r){if(!r)return null;if(Array.isArray(r)){for(var t,n=function(r,t){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(n)return(n=n.call(r)).next.bind(n);if(Array.isArray(r)||(n=function(r,t){if(r){if("string"==typeof r)return m(r,t);var n={}.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){n&&(r=n);var e=0;return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(r);!(t=n()).done;){var e=d(t.value);if(e)return e}return null}return r.tag===f()?r:r.children?d(r.children):null}n().initializers.add("lady-byron/reading-enhance",function(){(0,e.extend)(a().prototype,"view",function(r){var t,e,o;if(null==(t=this.attrs)||null==(t=t.params)||!t.q){var a=null==(e=this.attrs)?void 0:e.discussion;if(a){var i=null!=(o=a.attribute("lbReadingPosition"))?o:null;if(i&&!(i<=1)){var u=d(r);u&&u.attrs&&(u.attrs.href=n().route.discussion(a,i))}}}}),(0,e.override)(u().prototype,"view",function(r){for(var t=this,e=arguments.length,o=new Array(e>1?e-1:0),a=1;a<e;a++)o[a-1]=arguments[a];var i=r.apply(void 0,o),u=function(r){if(r){if(Array.isArray(r))return r.forEach(u);if(r.children&&u(r.children),r.tag===l()){r.attrs=r.attrs||{};var e=r.attrs.onPositionChange;r.attrs.onPositionChange=function(){if("function"==typeof e&&e.apply(void 0,arguments),n().session.user){var r=null==t?void 0:t.discussion;if(r){var o,a,i=function(){for(var r=document.querySelectorAll(".PostStream-item[data-number]"),t=0,n=Array.from(r);t<n.length;t++){var e=n[t],o=e.getBoundingClientRect();if(o.top>=0&&o.bottom<=(window.innerHeight||0)){var a=parseInt(e.dataset.number||"",10);if(a>0)return a}}return null}();i&&"number"==typeof i&&(o=r.id(),a=i,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:o,postNumber:a}}).catch(function(){})).then(function(){r.attribute("lbReadingPosition")!==i&&r.pushAttributes({lbReadingPosition:i})})}}}}}};return u(i),i})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map