/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),u=r(996),i=r(312),a=r(166),l=r(766),s=r(760);function c(){"use strict";var e=o(),r=e.m(c),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function d(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var p={throw:1,return:2,break:3,continue:3};function v(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,p[t],e)},delegateYield:function(t,o,u){return e.resultName=o,r(n.d,s(t),u)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,o){return e.w(v(t),r,n,o&&o.reverse())},isGeneratorFunction:d,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:a,async:function(t,e,r,n,o){return(d(e)?i:u)(v(t),e,r,n,o)},keys:l,values:s}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,u="function"==typeof Symbol?Symbol:{},i=u.iterator||"@@iterator",a=u.toStringTag||"@@toStringTag";function l(t,o,u,i){var a=o&&o.prototype instanceof c?o:c,l=Object.create(a.prototype);return n(l,"_invoke",function(t,n,o){var u,i,a,l=0,c=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return u=t,i=0,a=e,d.n=r,s}};function p(t,n){for(i=t,a=n,r=0;!f&&l&&!o&&r<c.length;r++){var o,u=c[r],p=d.p,v=u[2];t>3?(o=v===n)&&(a=u[(i=u[4])?5:(i=3,3)],u[4]=u[5]=e):u[0]<=p&&((o=t<2&&p<u[1])?(i=0,d.v=n,d.n=u[1]):p<v&&(o=t<3||u[0]>n||n>v)&&(u[4]=t,u[5]=n,d.n=v,i=0))}if(o||t>1)return s;throw f=!0,n}return function(o,c,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===c&&p(c,v),i=c,a=v;(r=i<2?e:a)||!f;){u||(i?i<3?(i>1&&(d.n=-1),p(i,a)):d.n=a:d.v=a);try{if(l=2,u){if(i||(o="next"),r=u[o]){if(!(r=r.call(u,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,i<2&&(i=0)}else 1===i&&(r=u.return)&&r.call(u),i<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),i=1);u=e}else if((r=(f=d.n<0)?a:t.call(n,d))!==s)break}catch(t){u=e,i=1,a=t}finally{l=1}}return{value:r,done:f}}}(t,u,i),!0),l}var s={};function c(){}function f(){}function d(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),v=d.prototype=c.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t}return f.prototype=d,n(v,"constructor",d),n(d,"constructor",f),f.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(v),n(v,a,"Generator"),n(v,i,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:l,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function u(t,o,i,a){try{var l=e[t](o),s=l.value;return s instanceof n?r.resolve(s.v).then(function(t){u("next",t,i,a)},function(t){u("throw",t,i,a)}):r.resolve(s).then(function(t){l.value=t,i(l)},function(t){return u("throw",t,i,a)})}catch(t){a(t)}}var i;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){u(t,n,e,r)})}return i=i?i.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,u,i){return new o(n().w(t,e,r,u),i||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,u){var i=Object.defineProperty;try{i({},"",{})}catch(r){i=0}t.exports=e=function(t,r,n,o){function u(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?i?i(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(u("next",0),u("throw",1),u("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,u)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,u){var i=n(t,e,r,o,u);return i.next().then(function(t){return t.done?t.value:i.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var u=e[n]={exports:{}};return t[n](u,u.exports,r),u.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var e=r.n(t);const n=flarum.core.compat["forum/states/PostStreamState"];var o=r.n(n);const u=flarum.core.compat["forum/components/PostStream"];var i=r.n(u),a={did:null,targetNum:null,left:0,expiresAt:0};function l(){return Date.now()}function s(t){return!!t&&a.did===t&&a.left>0&&l()<a.expiresAt}function c(){a.left>0&&(a.left-=1),a.left<=0&&(a.did=null,a.targetNum=null,a.expiresAt=0)}function f(t,e){if(!t)return!1;if("reply"===e)return!0;var r="function"==typeof t.lastPostNumber?t.lastPostNumber():null==t.attribute?void 0:t.attribute("lastPostNumber");if("number"==typeof e&&e>0){if("number"==typeof r&&r>0&&e>=r)return!0;if(a.targetNum&&e>=a.targetNum)return!0}return!1}function d(){e().initializers.add("lady-byron/reading-enhance-reply-jump",function(){(function(){if(!e().__lbReqHooked){e().__lbReqHooked=!0;var t=e().request.bind(e());e().request=function(e){var r=t(e);try{var n=String((null==e?void 0:e.method)||"").toUpperCase(),o=String((null==e?void 0:e.url)||"");return"POST"===n&&/\/posts(?:\?|$|\/)/.test(o)?r.then(function(t){var e,r,n,o,u,i=null!=(e=null!=(r=null==t||null==(n=t.data)||null==(n=n.relationships)||null==(n=n.discussion)||null==(n=n.data)?void 0:n.id)?r:null==t||null==(o=t.data)||null==(o=o.attributes)?void 0:o.discussionId)?e:null,s="number"==typeof(null==t||null==(u=t.data)||null==(u=u.attributes)?void 0:u.number)?t.data.attributes.number:null;return i&&function(t,e,r,n){void 0===r&&(r=1800),void 0===n&&(n=3),a.did=t,a.targetNum="number"==typeof e&&e>0?e:null,a.left=Math.max(1,n),a.expiresAt=l()+Math.max(300,r)}(String(i),s,1800,3),t}):r}catch(t){return r}}}})(),function(){var t=o().prototype.goToNumber;o().prototype.goToNumber=function(e){try{var r,n=null==this?void 0:this.discussion;if(s(null!=(r=null==n||null==n.id?void 0:n.id())?r:"function"==typeof(null==n?void 0:n.id)?n.id():null)&&f(n,e))return void c()}catch(t){}for(var o=arguments.length,u=new Array(o>1?o-1:0),i=1;i<o;i++)u[i-1]=arguments[i];return t.apply(this,[e].concat(u))};var e=i().prototype;if("function"==typeof e.triggerScroll){var r=e.triggerScroll;e.triggerScroll=function(){try{var t,e,n,o,u,i=null==this||null==(t=this.attrs)?void 0:t.state,a=null==i?void 0:i.discussion,l=null!=(e=null==a||null==a.id?void 0:a.id())?e:"function"==typeof(null==a?void 0:a.id)?a.id():null,d=null!=(n=null!=(o=null!=(u=null==i?void 0:i.targetPostNumber)?u:null==i?void 0:i.index)?o:(null==i?void 0:i.visible)&&i.visible.number)?n:null;if(s(l)&&f(a,d))return void c()}catch(t){}for(var p=arguments.length,v=new Array(p),h=0;h<p;h++)v[h]=arguments[h];return r.apply(this,v)}}if("function"==typeof e.scrollToNumber){var n=e.scrollToNumber;e.scrollToNumber=function(t){try{var e,r,o=null==this||null==(e=this.attrs)?void 0:e.state,u=null==o?void 0:o.discussion;if(s(null!=(r=null==u||null==u.id?void 0:u.id())?r:"function"==typeof(null==u?void 0:u.id)?u.id():null)&&f(u,t))return void c()}catch(t){}for(var i=arguments.length,a=new Array(i>1?i-1:0),l=1;l<i;l++)a[l-1]=arguments[l];return n.apply(this,[t].concat(a))}}if("function"==typeof e.scrollToIndex){var u=e.scrollToIndex;e.scrollToIndex=function(t){try{var e,r,n,o=null==this||null==(e=this.attrs)?void 0:e.state,i=null==o?void 0:o.discussion,a=null!=(r=null==i||null==i.id?void 0:i.id())?r:"function"==typeof(null==i?void 0:i.id)?i.id():null,l=null!=o&&null!=(n=o.visible)&&n.number&&"number"==typeof o.visible.number?o.visible.number:t;if(s(a)&&f(i,l))return void c()}catch(t){}for(var d=arguments.length,p=new Array(d>1?d-1:0),v=1;v<d;v++)p[v-1]=arguments[v];return u.apply(this,[t].concat(p))}}}()})}var p={halfRatio:.5,smooth:!0,headerSelector:".App-header"};function v(t,e){"scrollBy"in window?window.scrollBy({top:t,left:0,behavior:e?"smooth":"auto"}):(document.scrollingElement||document.documentElement||document.body).scrollTop+=t}function h(t,e,r,n,o,u,i){try{var a=t[u](i),l=a.value}catch(t){return void r(t)}a.done?e(l):Promise.resolve(l).then(n,o)}function b(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var u=t.apply(e,r);function i(t){h(u,n,o,i,a,"next",t)}function a(t){h(u,n,o,i,a,"throw",t)}i(void 0)})}}var y=r(183),x=r.n(y);const g=flarum.core.compat["common/extend"],w=flarum.core.compat["forum/components/DiscussionListItem"];var _=r.n(w);const S=flarum.core.compat["common/components/Link"];var P=r.n(S);function k(t){try{var e=new URL(t,window.location.origin);if(e.origin!==window.location.origin)return null;var r=e.pathname.match(/\/d\/(\d+)/);return r?r[1]:null}catch(t){return null}}function M(t){try{var e=new URL(t,window.location.origin);if(e.pathname.split("/").filter(Boolean).length>2)return!0;if(e.searchParams.has("near"))return!0;if(e.hash)return!0}catch(t){}return!1}function N(t){if(!("v17development-blog"in flarum.extensions))return!1;var r=e().forum.attribute("blogRedirectsEnabled"),n="both"===r||"discussions_only"===r,o=(null==t.tags?void 0:t.tags())||[];if(!n||0===o.length)return!1;var u=e().forum.attribute("blogTags")||[];return o.some(function(t){if(!t)return!1;var e=(null==t.parent?void 0:t.parent())||null;return-1!==u.indexOf(null==t.id?void 0:t.id())||e&&-1!==u.indexOf(null==e.id?void 0:e.id())})}var O=new Map;function T(t){return j.apply(this,arguments)}function j(){return(j=b(x().mark(function t(r){var n,o;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e().store.getById("discussions",r))||!n.slug()||void 0===n.attribute("lbReadingPosition")){t.next=1;break}return t.abrupt("return");case 1:if(!O.has(r)){t.next=2;break}return t.abrupt("return",O.get(r));case 2:return o=e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/discussions/"+r,params:{"fields[discussions]":"slug,title,lbReadingPosition,lastReadPostNumber"},background:!0}).then(function(t){e().store.pushPayload(t)}).finally(function(){O.delete(r)}),O.set(r,o),t.abrupt("return",o);case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}function R(t){var r=e().store.getById("discussions",t);if(!r)return null;var n=r.attribute("lbReadingPosition");if("number"==typeof n&&n>1)return n;var o=r.lastReadPostNumber();return"number"==typeof o&&o>1?o:null}e().initializers.add("lady-byron/reading-enhance",function(){var t,r,n,o,u;d(),o=Object.assign({},p,n||{}),u=!1,e().initializers.add("lady-byron/reading-enhance-shortcuts",function(){if(!u){u=!0;var t=function(t){if(!function(t){var r,n=t instanceof Element?t:null;if(!n)return!1;var o=n.closest('input, textarea, [contenteditable="true"], .TextEditor, .CodeMirror, .ProseMirror, .Composer, .Modal'),u=!(null==e()||null==(r=e().composer)||null==r.isVisible||!r.isVisible());return!!o||u}(t.target)&&!t.repeat){var r=function(t){if(t.ctrlKey||t.metaKey||t.altKey)return"";var e=[];t.shiftKey&&e.push("Shift");var r=1===t.key.length?t.key.toUpperCase():t.key;return e.push(r),e.join("+")}(t);if(r){var n=function(t){try{var e=document.querySelector(t);return e?e.getBoundingClientRect().height:0}catch(t){return 0}}(o.headerSelector),u=window.innerHeight||0;switch(r){case"Shift+D":t.preventDefault(),t.stopPropagation(),v(Math.max(1,Math.round(u*o.halfRatio)-Math.round(n/2)),o.smooth);break;case"Shift+U":t.preventDefault(),t.stopPropagation(),v(-Math.max(1,Math.round(u*o.halfRatio)-Math.round(n/2)),o.smooth);break;case"Shift+J":t.preventDefault(),t.stopPropagation(),v(u,o.smooth);break;case"Shift+K":t.preventDefault(),t.stopPropagation(),v(-u,o.smooth)}}}};window.addEventListener("keydown",t,!0),window.__lb_shortcuts={detach:function(){window.removeEventListener("keydown",t,!0)}}}}),t=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var r=e.target,n=k(r.href);n&&T(n),t.unobserve(r)}})},{rootMargin:"100px"}),r=function(){document.querySelectorAll('a[href^="/d/"]:not([data-lb-obs])').forEach(function(e){e.closest(".PostStreamScrubber, .Scrubber")||(t.observe(e),e.setAttribute("data-lb-obs","1"))})},(0,g.extend)(e(),"mount",r),(0,g.extend)(e(),"update",r),(0,g.extend)(_().prototype,"view",function(t){var r,n;if(null==(r=this.attrs)||null==(r=r.params)||!r.q){var o=null==(n=this.attrs)?void 0:n.discussion;if(o){var u=R(o.id());if(u){var i=function(t){var r;if(t){if(Array.isArray(t))return t.forEach(i);if(t.tag===P()&&null!=(r=t.attrs)&&r.href){if(t.attrs.className&&t.attrs.className.includes("DiscussionListItem-count"))return;var n;n=N(o)?e().route("blogArticle.near",{id:o.slug(),near:u}):e().route.discussion(o,u),t.attrs.href=n}t.children&&i(t.children)}};i(t)}}}}),document.addEventListener("click",function(){var t=b(x().mark(function t(r){var n,o,u,i,a,l,s;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.target.closest("a")){t.next=1;break}return t.abrupt("return");case 1:if(!n.closest(".PostStreamScrubber, .Scrubber")){t.next=2;break}return t.abrupt("return");case 2:if(o=k(n.href)){t.next=3;break}return t.abrupt("return");case 3:if(!M(n.href)){t.next=4;break}return t.abrupt("return");case 4:return r.preventDefault(),r.stopPropagation(),n.classList.add("lb-loading-jump"),t.prev=5,t.next=6,T(o);case 6:u=e().store.getById("discussions",o),i=R(o),n.classList.remove("lb-loading-jump"),i&&u&&u.slug()?N(u)?m.route.set(e().route("blogArticle.near",{id:u.slug(),near:i})):m.route.set(e().route.discussion(u,i)):i&&u?m.route.set("/d/"+o+"/"+i):(a=new URL(n.href,window.location.origin),m.route.set(a.pathname+a.search+a.hash)),t.next=8;break;case 7:t.prev=7,s=t.catch(5),console.error(s),n.classList.remove("lb-loading-jump"),(l=n.getAttribute("href"))&&m.route.set(l);case 8:case"end":return t.stop()}},t,null,[[5,7]])}));return function(e){return t.apply(this,arguments)}}(),{capture:!0})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map