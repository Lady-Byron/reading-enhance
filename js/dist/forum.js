/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),a=r(996),u=r(312),i=r(166),s=r(766),l=r(760);function c(){"use strict";var e=o(),r=e.m(c),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var d={throw:1,return:2,break:3,continue:3};function b(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,d[t],e)},delegateYield:function(t,o,a){return e.resultName=o,r(n.d,l(t),a)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,o){return e.w(b(t),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:i,async:function(t,e,r,n,o){return(p(e)?u:a)(b(t),e,r,n,o)},keys:s,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function s(t,o,a,u){var i=o&&o.prototype instanceof c?o:c,s=Object.create(i.prototype);return n(s,"_invoke",function(t,n,o){var a,u,i,s=0,c=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return a=t,u=0,i=e,p.n=r,l}};function d(t,n){for(u=t,i=n,r=0;!f&&s&&!o&&r<c.length;r++){var o,a=c[r],d=p.p,b=a[2];t>3?(o=b===n)&&(i=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=t<2&&d<a[1])?(u=0,p.v=n,p.n=a[1]):d<b&&(o=t<3||a[0]>n||n>b)&&(a[4]=t,a[5]=n,p.n=b,u=0))}if(o||t>1)return l;throw f=!0,n}return function(o,c,b){if(s>1)throw TypeError("Generator is already running");for(f&&1===c&&d(c,b),u=c,i=b;(r=u<2?e:i)||!f;){a||(u?u<3?(u>1&&(p.n=-1),d(u,i)):p.n=i:p.v=i);try{if(s=2,a){if(u||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,u<2&&(u=0)}else 1===u&&(r=a.return)&&r.call(a),u<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=e}else if((r=(f=p.n<0)?i:t.call(n,p))!==l)break}catch(t){a=e,u=1,i=t}finally{s=1}}return{value:r,done:f}}}(t,a,u),!0),s}var l={};function c(){}function f(){}function p(){}r=Object.getPrototypeOf;var d=[][u]?r(r([][u]())):(n(r={},u,function(){return this}),r),b=p.prototype=c.prototype=Object.create(d);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,n(t,i,"GeneratorFunction")),t.prototype=Object.create(b),t}return f.prototype=p,n(b,"constructor",p),n(p,"constructor",f),f.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(b),n(b,i,"Generator"),n(b,u,function(){return this}),n(b,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m:v}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function a(t,o,u,i){try{var s=e[t](o),l=s.value;return l instanceof n?r.resolve(l.v).then(function(t){a("next",t,u,i)},function(t){a("throw",t,u,i)}):r.resolve(l).then(function(t){s.value=t,u(s)},function(t){return a("throw",t,u,i)})}catch(t){i(t)}}var u;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){a(t,n,e,r)})}return u=u?u.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,a,u){return new o(n().w(t,e,r,a),u||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,a){var u=Object.defineProperty;try{u({},"",{})}catch(r){u=0}t.exports=e=function(t,r,n,o){function a(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?u?u(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(a("next",0),a("throw",1),a("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,a)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,a){var u=n(t,e,r,o,a);return u.next().then(function(t){return t.done?t.value:u.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e,r,n,o,a,u){try{var i=t[a](u),s=i.value}catch(t){return void r(t)}i.done?e(s):Promise.resolve(s).then(n,o)}function e(e){return function(){var r=this,n=arguments;return new Promise(function(o,a){var u=e.apply(r,n);function i(e){t(u,o,a,i,s,"next",e)}function s(e){t(u,o,a,i,s,"throw",e)}i(void 0)})}}var n=r(183),o=r.n(n);const a=flarum.core.compat["forum/app"];var u=r.n(a);const i=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/components/DiscussionListItem"];var l=r.n(s);const c=flarum.core.compat["forum/components/DiscussionPage"];var f=r.n(c);const p=flarum.core.compat["forum/components/PostStream"];var d=r.n(p);const b=flarum.core.compat["common/components/Link"];var v=r.n(b);function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var y=Object.create(null),x=Object.create(null),g=Object.create(null);u().initializers.add("lady-byron/reading-enhance",function(){(0,i.extend)(l().prototype,"view",function(t){var e,r,n;if(null==(e=this.attrs)||null==(e=e.params)||!e.q){var o=null==(r=this.attrs)?void 0:r.discussion;if(o){var a=null!=(n=o.attribute("lbReadingPosition"))?n:null;!a||a<=1||t.children.forEach(function(t){t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.forEach(function(t){var e;t&&t.tag===v()&&(e=function(t){if(!("v17development-blog"in flarum.extensions))return!1;var e=u().forum.attribute("blogRedirectsEnabled"),r="both"===e||"discussions_only"===e,n=(null==t.tags?void 0:t.tags())||[];if(!r||0===n.length)return!1;var o=u().forum.attribute("blogTags")||[];return n.some(function(t){if(!t)return!1;var e=(null==t.parent?void 0:t.parent())||null;return-1!==o.indexOf(null==t.id?void 0:t.id())||e&&-1!==o.indexOf(null==e.id?void 0:e.id())})}(o)?a>1?u().route("blogArticle.near",{id:o.slug(),near:a}):u().route("blogArticle",{id:o.slug()}):u().route.discussion(o,a),t.attrs.href=e)})})}}}),(0,i.override)(f().prototype,"view",function(t){for(var e=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var a=t.apply(void 0,n),i=function(t){if(t){if(Array.isArray(t))return t.forEach(i);if(t.children&&i(t.children),t.tag===d()){t.attrs=t.attrs||{};var r=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if("function"==typeof r&&r.apply(void 0,n),u().session.user){var a=null==e?void 0:e.discussion;if(a){var i=function(t){for(var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return h(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);!(e=r()).done;){var n=e.value;if(null!=n)if("number"==typeof n){if(n>0)return n}else if("object"==typeof n){if("number"==typeof n.number&&n.number>0)return n.number;if("number"==typeof n.postNumber&&n.postNumber>0)return n.postNumber;if("number"==typeof n.near&&n.near>0)return n.near;if(n.visible&&"number"==typeof n.visible.number&&n.visible.number>0)return n.visible.number}}return null}(n);i||(i=function(){try{var t=new URL(window.location.href),e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1!==r&&e.length>r+2){var n=parseInt(e[r+2],10);if(!Number.isNaN(n)&&n>0)return n}var o=parseInt(t.searchParams.get("near")||"",10);if(!Number.isNaN(o)&&o>0)return o}catch(t){}return null}()),i||(i=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),e=0,r=Array.from(t);e<r.length;e++){var n=r[e],o=n.getBoundingClientRect();if(o.top<=4&&o.bottom>4){var a=parseInt(n.dataset.number||"",10);if(a>0)return a}}for(var u=0,i=Array.from(t);u<i.length;u++){var s=i[u],l=s.getBoundingClientRect();if(l.top>=4&&l.top<(window.innerHeight||0)){var c=parseInt(s.dataset.number||"",10);if(c>0)return c}}return null}()),i&&"number"==typeof i&&i>0&&function(t,e){var r=t.id();x[r]!==e&&(x[r]=e,y[r]&&window.clearTimeout(y[r]),y[r]=window.setTimeout(function(){var e,n,o=x[r];if(!("number"!=typeof o||o<=0)){var a,i,s=null!=(e=t.attribute("lbReadingPosition"))?e:0,l=null!=(n=g[r])?n:s;o!==s&&o!==l&&(a=r,i=o,u().request({method:"POST",url:u().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:a,postNumber:i}}).catch(function(){})).then(function(){g[r]=o,t.attribute("lbReadingPosition")!==o&&t.pushAttributes({lbReadingPosition:o})})}},200))}(a,i)}}}}}};return i(a),a});var t=new Map;function r(t){return n.apply(this,arguments)}function n(){return(n=e(o().mark(function e(r){var n,a,i,s,l,c,f,p,d,b;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u().session.user){e.next=1;break}return e.abrupt("return",null);case 1:if(!t.has(r)){e.next=2;break}return e.abrupt("return",t.get(r));case 2:if(!(n=u().store.getById("discussions",r))){e.next=3;break}if(a=n.attribute&&n.attribute("lbReadingPosition"),i="function"==typeof n.lastReadPostNumber?n.lastReadPostNumber():n.attribute&&n.attribute("lastReadPostNumber"),!(s="number"==typeof a&&a>1?a:"number"==typeof i&&i>1?i:null)){e.next=3;break}return t.set(r,s),e.abrupt("return",s);case 3:return e.prev=3,e.next=4,u().request({method:"GET",url:u().forum.attribute("apiUrl")+"/discussions/"+r,params:{"fields[discussions]":"title,slug,lastReadPostNumber,lbReadingPosition"}});case 4:if(c=e.sent,f=(null==c||null==(l=c.data)?void 0:l.attributes)||{},p="number"==typeof f.lbReadingPosition?f.lbReadingPosition:null,d="number"==typeof f.lastReadPostNumber?f.lastReadPostNumber:null,!(b=p&&p>1?p:d&&d>1?d:null)){e.next=5;break}return t.set(r,b),e.abrupt("return",b);case 5:e.next=7;break;case 6:e.prev=6,e.catch(3);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,null,[[3,6]])}))).apply(this,arguments)}function a(t){try{var e=new URL(u().forum.attribute("baseUrl"));return t.origin===e.origin}catch(t){return!1}}function s(t){var e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1!==r&&e.length>r+2){var n=parseInt(e[r+2],10);if(!Number.isNaN(n)&&n>0)return!0}var o=parseInt(t.searchParams.get("near")||"",10);return!Number.isNaN(o)&&o>0||!(!t.hash||!/^#p\d+$/i.test(t.hash))}function c(t){var e=t.pathname.split("/").filter(Boolean),r=e.indexOf("d");if(-1===r||e.length<=r+1)return null;var n=e[r+1],o=/^(\d+)/.exec(n);return o?o[1]:null}function p(t,e){var r=t.pathname.split("/").filter(Boolean),n=r.indexOf("d");if(!(-1===n||r.length<=n+1)){var o="/"+r.slice(0,n+2).join("/");t.pathname=o+"/"+e,t.searchParams.delete("near"),t.hash&&/^#p\d+$/i.test(t.hash)&&(t.hash="")}}var b=new WeakMap;function w(t){for(var e=t;e&&e!==document.body;){if(e instanceof HTMLAnchorElement)return e;e=e.parentElement}return null}document.addEventListener("mouseover",function(t){var n=w(t.target);if(n){var u=window.setTimeout(e(o().mark(function t(){var e,u,i;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a(e=new URL(n.href,window.location.href))&&!s(e)){t.next=1;break}return t.abrupt("return");case 1:if(u=c(e)){t.next=2;break}return t.abrupt("return");case 2:return t.next=3,r(u);case 3:(i=t.sent)&&i>1&&(n.dataset.lbRewrittenNear?parseInt(n.dataset.lbRewrittenNear,10):null)!==i&&(p(e,i),n.href=e.toString(),n.dataset.lbRewritten="1",n.dataset.lbRewrittenNear=String(i)),t.next=5;break;case 4:t.prev=4,t.catch(0);case 5:case"end":return t.stop()}},t,null,[[0,4]])})),120);b.set(n,u)}},{passive:!0}),document.addEventListener("mouseout",function(t){var e=w(t.target);if(e){var r=b.get(e);r&&(window.clearTimeout(r),b.delete(e))}},{passive:!0}),document.addEventListener("click",function(n){var i=w(n.target);if(i){var l;try{l=new URL(i.href,window.location.href)}catch(t){return}if(a(l)&&!s(l)){var f=c(l);f&&(n.preventDefault(),e(o().mark(function e(){var n,a,s,c,d;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=null!=(n=t.get(f))?n:null)||(s=u().store.getById("discussions",f))&&(c=s.attribute&&s.attribute("lbReadingPosition"),d="function"==typeof s.lastReadPostNumber?s.lastReadPostNumber():s.attribute&&s.attribute("lastReadPostNumber"),a="number"==typeof c&&c>1?c:"number"==typeof d&&d>1?d:null),a){e.next=2;break}return e.next=1,r(f);case 1:a=e.sent;case 2:if(!(a&&a>1)){e.next=3;break}return p(l,a),e.abrupt("return",m.route.set(l.pathname+l.search+l.hash));case 3:return e.abrupt("return",m.route.set(i.getAttribute("href")));case 4:case"end":return e.stop()}},e)}))().catch(function(){m.route.set(i.getAttribute("href"))}))}}},{capture:!0})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map