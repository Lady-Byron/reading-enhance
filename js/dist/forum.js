(()=>{var t={858:t=>{"use strict";if(void 0===flarum.core.compat["forum/components/DiscussionSearchResult"]){var r=new Error("Cannot find module 'flarum.core.compat['forum/components/DiscussionSearchResult']'");throw r.code="MODULE_NOT_FOUND",r}t.exports=flarum.core.compat["forum/components/DiscussionSearchResult"]}},r={};function o(n){var e=r[n];if(void 0!==e)return e.exports;var i=r[n]={exports:{}};return t[n](i,i.exports,o),i.exports}o.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return o.d(r,{a:r}),r},o.d=(t,r)=>{for(var n in r)o.o(r,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var r=o.n(t);const n=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/DiscussionListItem"];var i=o.n(e);const a=flarum.core.compat["forum/components/DiscussionPage"];var s=o.n(a);const u=flarum.core.compat["forum/components/PostStream"];var c=o.n(u);const l=flarum.core.compat["common/components/Link"];var f=o.n(l),d=null;try{d=o(858).default}catch(t){}function p(t){return/[?&]near=\d+/.test(t)||/\/d\/[^/]+\/\d+(?:[/?#]|$)/.test(t)||/#p\d+/.test(t)}function v(t,o){var n=o&&o>1?o:0;return function(t){if(!("v17development-blog"in flarum.extensions))return!1;var o=r().forum.attribute("blogRedirectsEnabled"),n="both"===o||"discussions_only"===o,e=(null==t.tags?void 0:t.tags())||[];if(!n||0===e.length)return!1;var i=r().forum.attribute("blogTags")||[];return e.some(function(t){if(!t)return!1;var r=(null==t.parent?void 0:t.parent())||null;return-1!==i.indexOf(null==t.id?void 0:t.id())||r&&-1!==i.indexOf(null==r.id?void 0:r.id())})}(t)?n>1?r().route("blogArticle.near",{id:t.slug(),near:n}):r().route("blogArticle",{id:t.slug()}):r().route.discussion(t,n)}r().initializers.add("lady-byron/reading-enhance",function(){(0,n.extend)(i().prototype,"view",function(t){var r,o,n=null==(r=this.attrs)?void 0:r.discussion;if(n){var e=null!=(o=n.attribute("lbReadingPosition"))?o:null;!e||e<=1||t.children.forEach(function(t){t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.forEach(function(t){var r;if(t&&t.tag===f()){var o=null==(r=t.attrs)?void 0:r.href;o&&p(o)||(t.attrs.href=v(n,e))}})})}}),d&&d.prototype&&(0,n.extend)(d.prototype,"view",function(t){var r,o,n=null==(r=this.attrs)?void 0:r.discussion;if(n){var e=null!=(o=n.attribute("lbReadingPosition"))?o:null;!e||e<=1||t.children.forEach(function(t){var r;if(t&&t.tag===f()){var o=null==(r=t.attrs)?void 0:r.href;o&&p(o)||(t.attrs.href=v(n,e))}})}}),(0,n.extend)(s().prototype,"show",function(t,r){var o;if(r){var n=m.route.get();if(!p(n)){var e=null!=(o=r.attribute("lbReadingPosition"))?o:null;if(e&&!(e<=1)){var i=v(r,e);n!==i&&m.route.set(i,void 0,{replace:!0})}}}}),(0,n.override)(s().prototype,"view",function(t){for(var o=this,n=arguments.length,e=new Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];var a=t.apply(void 0,e),s=function(t){if(t){if(Array.isArray(t))return t.forEach(s);if(t.children&&s(t.children),t.tag===c()){t.attrs=t.attrs||{};var n=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof n&&n.apply(void 0,arguments),r().session.user){var t=null==o?void 0:o.discussion;if(t){var e,i,a=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,o=Array.from(t);r<o.length;r++){var n=o[r],e=n.getBoundingClientRect();if(e.top>=0&&e.bottom<=(window.innerHeight||0)){var i=parseInt(n.dataset.number||"",10);if(i>0)return i}}return null}();a&&"number"==typeof a&&(e=t.id(),i=a,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:e,postNumber:i}}).catch(function(){})).then(function(){t.attribute("lbReadingPosition")!==a&&t.pushAttributes({lbReadingPosition:a})})}}}}}};return s(a),a})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map