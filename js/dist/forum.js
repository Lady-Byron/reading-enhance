(()=>{var t={n:r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},d:(r,n)=>{for(var o in n)t.o(n,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:n[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["forum/app"];var n=t.n(r);const o=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/DiscussionListItem"];var i=t.n(e);const a=flarum.core.compat["forum/components/DiscussionPage"];var s=t.n(a);const u=flarum.core.compat["forum/components/PostStream"];var l=t.n(u);const c=flarum.core.compat["common/components/Link"];var d=t.n(c);n().initializers.add("lady-byron/reading-enhance",function(){(0,o.extend)(i().prototype,"view",function(t){var r,o,e;if(null==(r=this.attrs)||null==(r=r.params)||!r.q){var i=null==(o=this.attrs)?void 0:o.discussion;if(i){var a=null!=(e=i.attribute("lbReadingPosition"))?e:null;!a||a<=1||t.children.forEach(function(t){t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("DiscussionListItem-content")&&t.children.forEach(function(t){var r;t&&t.tag===d()&&(r=function(t){if(!("v17development-blog"in flarum.extensions))return!1;var r=n().forum.attribute("blogRedirectsEnabled"),o="both"===r||"discussions_only"===r,e=(null==t.tags?void 0:t.tags())||[];if(!o||0===e.length)return!1;var i=n().forum.attribute("blogTags")||[];return e.some(function(t){if(!t)return!1;var r=(null==t.parent?void 0:t.parent())||null;return-1!==i.indexOf(null==t.id?void 0:t.id())||r&&-1!==i.indexOf(null==r.id?void 0:r.id())})}(i)?a>1?n().route("blogArticle.near",{id:i.slug(),near:a}):n().route("blogArticle",{id:i.slug()}):n().route.discussion(i,a),t.attrs.href=r)})})}}}),(0,o.override)(s().prototype,"view",function(t){for(var r=this,o=arguments.length,e=new Array(o>1?o-1:0),i=1;i<o;i++)e[i-1]=arguments[i];var a=t.apply(void 0,e),s=function(t){if(t){if(Array.isArray(t))return t.forEach(s);if(t.children&&s(t.children),t.tag===l()){t.attrs=t.attrs||{};var o=t.attrs.onPositionChange;t.attrs.onPositionChange=function(){if("function"==typeof o&&o.apply(void 0,arguments),n().session.user){var t=null==r?void 0:r.discussion;if(t){var e,i,a=function(){for(var t=document.querySelectorAll(".PostStream-item[data-number]"),r=0,n=Array.from(t);r<n.length;r++){var o=n[r],e=o.getBoundingClientRect();if(e.top>=0&&e.bottom<=(window.innerHeight||0)){var i=parseInt(o.dataset.number||"",10);if(i>0)return i}}return null}();a&&"number"==typeof a&&(e=t.id(),i=a,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/ladybyron/reading-position",body:{discussionId:e,postNumber:i}}).catch(function(){})).then(function(){t.attribute("lbReadingPosition")!==a&&t.pushAttributes({lbReadingPosition:a})})}}}}}};return s(a),a})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map