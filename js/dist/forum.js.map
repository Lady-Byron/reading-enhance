{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@lady-byron/reading-enhance-js/webpack/bootstrap","webpack://@lady-byron/reading-enhance-js/webpack/runtime/compat get default export","webpack://@lady-byron/reading-enhance-js/webpack/runtime/define property getters","webpack://@lady-byron/reading-enhance-js/webpack/runtime/hasOwnProperty shorthand","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/app']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['common/extend']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['common/components/Link']\"","webpack://@lady-byron/reading-enhance-js/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","// js/src/forum/index.ts\nimport app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport Link from 'flarum/common/components/Link';\n\n/** ---- v17 blog 路由判定（简化版，与原实现一致） ---- */\nfunction shouldRedirectDiscussionToBlog(discussion: any): boolean {\n  // @ts-ignore\n  if (!('v17development-blog' in flarum.extensions)) return false;\n\n  const redirects = app.forum.attribute('blogRedirectsEnabled');\n  const discussionRedirectEnabled =\n    redirects === 'both' || redirects === 'discussions_only';\n\n  const tags = discussion.tags?.() || [];\n  if (!discussionRedirectEnabled || tags.length === 0) return false;\n\n  const blogTags = app.forum.attribute<string[]>('blogTags') || [];\n\n  return tags.some((tag: any) => {\n    if (!tag) return false;\n    const parent = tag.parent?.() || null;\n    return (\n      blogTags.indexOf(tag.id?.()!) !== -1 ||\n      (parent && blogTags.indexOf(parent.id?.()!) !== -1)\n    );\n  });\n}\n/** ---------------------------------------------------------- */\n\n/** 从 PostStream 的 onPositionChange 回调参数中尽量还原“当前可见楼层号” */\nfunction derivePostNumberFromPositionChangeArgs(args: any[]): number | null {\n  // 兼容若干可能的签名： (index, number) / ({ number }) / ({ postNumber }) / ({ near }) …\n  for (const a of args) {\n    if (a == null) continue;\n\n    if (typeof a === 'number') {\n      // 注意：有的实现第一个可能是 index，但通常会出现“一个明显大于 0 的 number”\n      if (a > 0) return a;\n      continue;\n    }\n\n    if (typeof a === 'object') {\n      // 常见字段\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (typeof a.number === 'number' && a.number > 0) return a.number;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (typeof a.postNumber === 'number' && a.postNumber > 0) return a.postNumber;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (typeof a.near === 'number' && a.near > 0) return a.near;\n      // 某些包装对象 visible: { number }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (a.visible && typeof a.visible.number === 'number' && a.visible.number > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        return a.visible.number as number;\n      }\n    }\n  }\n  return null;\n}\n\n/** 从当前 URL 提取 near（/d/:id/:near 或 ?near=） */\nfunction extractNearFromUrl(): number | null {\n  try {\n    const url = new URL(window.location.href);\n\n    // 1) 路径段 /d/:id/:near\n    const parts = url.pathname.split('/').filter(Boolean);\n    const dIndex = parts.indexOf('d');\n    if (dIndex !== -1 && parts.length > dIndex + 2) {\n      const maybeNear = parseInt(parts[dIndex + 2], 10);\n      if (!Number.isNaN(maybeNear) && maybeNear > 0) return maybeNear;\n    }\n\n    // 2) 查询参数 ?near=\n    const qNear = parseInt(url.searchParams.get('near') || '', 10);\n    if (!Number.isNaN(qNear) && qNear > 0) return qNear;\n  } catch {\n    // ignore\n  }\n  return null;\n}\n\n/** 退路：取“视口顶部相交”的第一楼（部分可见即可），更贴近原生体验 */\nfunction extractTopPartiallyVisible(): number | null {\n  const items = document.querySelectorAll<HTMLElement>('.PostStream-item[data-number]');\n  const viewportTop = 0 + 4; // 给 4px 容忍，避免顶部边框抖动\n  for (const el of Array.from(items)) {\n    const rect = el.getBoundingClientRect();\n    // 只要顶部在视口上方/内，且底部仍在视口下方（有任意可见面积）\n    if (rect.top <= viewportTop && rect.bottom > viewportTop) {\n      const n = parseInt(el.dataset.number || '', 10);\n      if (n > 0) return n;\n    }\n  }\n  // 若没有正好跨过顶部的，择第一个“下半部进入视口”的\n  for (const el of Array.from(items)) {\n    const rect = el.getBoundingClientRect();\n    if (rect.top >= viewportTop && rect.top < (window.innerHeight || 0)) {\n      const n = parseInt(el.dataset.number || '', 10);\n      if (n > 0) return n;\n    }\n  }\n  return null;\n}\n\n/** 写库（静默失败即可） */\nfunction savePosition(discussionId: string, postNumber: number) {\n  return app\n    .request({\n      method: 'POST',\n      url: `${app.forum.attribute('apiUrl')}/ladybyron/reading-position`,\n      body: { discussionId, postNumber },\n    })\n    .catch(() => {});\n}\n\n/** 轻节流与只前进：避免高频/倒退写入 */\nconst lastSentByDiscussion: Record<string, number> = Object.create(null);\nconst pendingTimerByDiscussion: Record<string, number> = Object.create(null);\n\nfunction scheduleSaveForwardOnly(discussion: any, candidate: number) {\n  const id: string = discussion.id();\n  const currentSaved = discussion.attribute('lbReadingPosition') ?? 0;\n  const lastSent = lastSentByDiscussion[id] ?? 0;\n\n  // 只前进：新数必须 > 两个本地参照\n  const target = Math.max(candidate | 0, 0);\n  if (!(target > currentSaved && target > lastSent)) return;\n\n  // 合并 200ms 内的多次抖动，只保留最大值\n  lastSentByDiscussion[id] = target;\n  if (pendingTimerByDiscussion[id]) window.clearTimeout(pendingTimerByDiscussion[id]);\n\n  pendingTimerByDiscussion[id] = window.setTimeout(() => {\n    const toSend = lastSentByDiscussion[id];\n    // 二次确认“只前进”\n    if (!(toSend > (discussion.attribute('lbReadingPosition') ?? 0))) return;\n\n    savePosition(id, toSend).then(() => {\n      // 同步到模型，供列表改写 near 立即可用\n      if (discussion.attribute('lbReadingPosition') !== toSend) {\n        discussion.pushAttributes({ lbReadingPosition: toSend });\n      }\n    });\n  }, 200);\n}\n\napp.initializers.add('lady-byron/reading-enhance', () => {\n  /**\n   * A) 改写“讨论列表项”里的 <Link>（与原先一致）：\n   *    - 跳过搜索页（this.attrs.params.q 存在时不改写）\n   *    - 用 lbReadingPosition 作为 near\n   *    - 兼容 v17 blog\n   */\n  extend(DiscussionListItem.prototype, 'view', function (vdom: any) {\n    // 搜索结果保留“最相关”默认体验\n    if ((this as any).attrs?.params?.q) return;\n\n    const discussion = (this as any).attrs?.discussion;\n    if (!discussion) return;\n\n    const recorded: number | null = discussion.attribute('lbReadingPosition') ?? null;\n    if (!recorded || recorded <= 1) return; // 无记录或仅 1 楼则不带 near\n\n    (vdom.children as any[]).forEach((child: any) => {\n      if (\n        !child ||\n        !child.attrs ||\n        !child.attrs.className ||\n        child.attrs.className.indexOf('DiscussionListItem-content') === -1\n      ) {\n        return;\n      }\n\n      (child.children as any[]).forEach((sub: any) => {\n        if (!sub || sub.tag !== Link) return;\n\n        let href: string;\n\n        if (shouldRedirectDiscussionToBlog(discussion)) {\n          href =\n            recorded > 1\n              ? app.route('blogArticle.near', { id: discussion.slug(), near: recorded })\n              : app.route('blogArticle', { id: discussion.slug() });\n        } else {\n          href = app.route.discussion(discussion, recorded);\n        }\n\n        sub.attrs.href = href;\n      });\n    });\n  });\n\n  /**\n   * B) 与原生同步的“阅读位置 → 实时写库”：\n   *    - 直接复用 PostStream 的 onPositionChange（与原生 URL 更新同源）\n   *    - 回调缺失/不可判读时：回退 URL near → 回退顶部相交探测\n   *    - 仅向前推进 + 200ms 合并\n   */\n  override(DiscussionPage.prototype, 'view', function (original: any, ...args: any[]) {\n    const vdom = original(...args);\n\n    const inject = (node: any) => {\n      if (!node) return;\n      if (Array.isArray(node)) return node.forEach(inject);\n      if (node.children) inject(node.children);\n\n      if (node.tag === PostStream) {\n        node.attrs = node.attrs || {};\n        const prev = node.attrs.onPositionChange;\n\n        node.attrs.onPositionChange = (...cbArgs: any[]) => {\n          if (typeof prev === 'function') prev(...cbArgs);\n          if (!app.session.user) return;\n\n          const dp = this as any;\n          const discussion = dp?.discussion;\n          if (!discussion) return;\n\n          // 1) 首选：从回调参数还原（与原生完全一致的来源）\n          let n = derivePostNumberFromPositionChangeArgs(cbArgs);\n\n          // 2) 回退：从 URL 近因（原生滚动时会同步 near 到地址栏）\n          if (!n) n = extractNearFromUrl();\n\n          // 3) 最后退路：顶部相交的首个部分可见楼层\n          if (!n) n = extractTopPartiallyVisible();\n\n          if (n && typeof n === 'number' && n > 0) {\n            scheduleSaveForwardOnly(discussion, n);\n          }\n        };\n      }\n    };\n\n    inject(vdom);\n    return vdom;\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","lastSentByDiscussion","create","pendingTimerByDiscussion","app","add","extend","DiscussionListItem","vdom","_attrs","_attrs2","_discussion$attribute3","this","attrs","params","q","discussion","recorded","attribute","children","forEach","child","className","indexOf","sub","href","tag","Link","extensions","redirects","discussionRedirectEnabled","tags","length","blogTags","some","parent","id","shouldRedirectDiscussionToBlog","slug","near","override","DiscussionPage","original","_this","_len","arguments","args","Array","_key","apply","inject","node","isArray","PostStream","prev","onPositionChange","_len2","cbArgs","_key2","user","n","_step","_iterator","_createForOfIteratorHelperLoose","done","value","number","postNumber","visible","derivePostNumberFromPositionChangeArgs","url","URL","window","location","parts","pathname","split","filter","Boolean","dIndex","maybeNear","parseInt","Number","isNaN","qNear","searchParams","_unused","extractNearFromUrl","items","document","querySelectorAll","_i","_Array$from","from","el","rect","getBoundingClientRect","top","bottom","dataset","_i2","_Array$from2","innerHeight","extractTopPartiallyVisible","candidate","_discussion$attribute","_lastSentByDiscussion","currentSaved","lastSent","target","Math","max","clearTimeout","setTimeout","_discussion$attribute2","discussionId","toSend","method","body","then","pushAttributes","lbReadingPosition","scheduleSaveForwardOnly"],"sourceRoot":""}