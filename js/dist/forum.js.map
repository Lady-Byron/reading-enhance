{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regenerator.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/OverloadYield.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/regenerator/index.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorDefine.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/typeof.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorValues.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorKeys.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorAsync.js","webpack://@lady-byron/reading-enhance-js/webpack/bootstrap","webpack://@lady-byron/reading-enhance-js/webpack/runtime/compat get default export","webpack://@lady-byron/reading-enhance-js/webpack/runtime/define property getters","webpack://@lady-byron/reading-enhance-js/webpack/runtime/hasOwnProperty shorthand","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/app']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['common/extend']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['common/components/Link']\"","webpack://@lady-byron/reading-enhance-js/./src/forum/index.ts"],"sourcesContent":["var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","// js/src/forum/index.ts\nimport app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport Link from 'flarum/common/components/Link';\n\n/** ---- v17 blog 路由判定（与你现有实现一致） ---- */\nfunction shouldRedirectDiscussionToBlog(discussion: any): boolean {\n  // @ts-ignore\n  if (!('v17development-blog' in flarum.extensions)) return false;\n\n  const redirects = app.forum.attribute('blogRedirectsEnabled');\n  const discussionRedirectEnabled =\n    redirects === 'both' || redirects === 'discussions_only';\n\n  const tags = discussion.tags?.() || [];\n  if (!discussionRedirectEnabled || tags.length === 0) return false;\n\n  const blogTags = app.forum.attribute<string[]>('blogTags') || [];\n\n  return tags.some((tag: any) => {\n    if (!tag) return false;\n    const parent = tag.parent?.() || null;\n    return (\n      blogTags.indexOf(tag.id?.()!) !== -1 ||\n      (parent && blogTags.indexOf(parent.id?.()!) !== -1)\n    );\n  });\n}\n\n/** ============ 与原生一致的“当前位置 → 楼层号”提取工具 ============ */\nfunction derivePostNumberFromPositionChangeArgs(args: any[]): number | null {\n  for (const a of args) {\n    if (a == null) continue;\n\n    if (typeof a === 'number') {\n      if (a > 0) return a;\n    } else if (typeof a === 'object') {\n      // number / postNumber / near / visible.number\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (typeof a.number === 'number' && a.number > 0) return a.number;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (typeof a.postNumber === 'number' && a.postNumber > 0) return a.postNumber;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (typeof a.near === 'number' && a.near > 0) return a.near;\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (a.visible && typeof a.visible.number === 'number' && a.visible.number > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        return a.visible.number as number;\n      }\n    }\n  }\n  return null;\n}\n\nfunction extractNearFromUrl(): number | null {\n  try {\n    const url = new URL(window.location.href);\n    // /d/:id/:near\n    const parts = url.pathname.split('/').filter(Boolean);\n    const dIndex = parts.indexOf('d');\n    if (dIndex !== -1 && parts.length > dIndex + 2) {\n      const maybeNear = parseInt(parts[dIndex + 2], 10);\n      if (!Number.isNaN(maybeNear) && maybeNear > 0) return maybeNear;\n    }\n    // ?near=\n    const qNear = parseInt(url.searchParams.get('near') || '', 10);\n    if (!Number.isNaN(qNear) && qNear > 0) return qNear;\n  } catch {}\n  return null;\n}\n\n/** 顶部相交（部分可见即可），作为最后退路 */\nfunction extractTopPartiallyVisible(): number | null {\n  const items = document.querySelectorAll<HTMLElement>('.PostStream-item[data-number]');\n  const viewportTop = 4;\n  for (const el of Array.from(items)) {\n    const rect = el.getBoundingClientRect();\n    if (rect.top <= viewportTop && rect.bottom > viewportTop) {\n      const n = parseInt(el.dataset.number || '', 10);\n      if (n > 0) return n;\n    }\n  }\n  for (const el of Array.from(items)) {\n    const rect = el.getBoundingClientRect();\n    if (rect.top >= viewportTop && rect.top < (window.innerHeight || 0)) {\n      const n = parseInt(el.dataset.number || '', 10);\n      if (n > 0) return n;\n    }\n  }\n  return null;\n}\n\n/** 写库（lb_read_post_number；静默失败即可） */\nfunction savePosition(discussionId: string, postNumber: number) {\n  return app\n    .request({\n      method: 'POST',\n      url: `${app.forum.attribute('apiUrl')}/ladybyron/reading-position`,\n      body: { discussionId, postNumber },\n    })\n    .catch(() => {});\n}\n\n/** 200ms 轻节流 + 去重（双向允许） */\nconst DEBOUNCE_MS = 200;\nconst pendingTimerByDiscussion: Record<string, number> = Object.create(null);\nconst pendingCandidateByDiscussion: Record<string, number> = Object.create(null);\nconst lastCommittedByDiscussion: Record<string, number> = Object.create(null);\n\nfunction scheduleSaveBidirectional(discussion: any, candidate: number) {\n  const id: string = discussion.id();\n  if (pendingCandidateByDiscussion[id] === candidate) return;\n\n  pendingCandidateByDiscussion[id] = candidate;\n\n  if (pendingTimerByDiscussion[id]) window.clearTimeout(pendingTimerByDiscussion[id]);\n\n  pendingTimerByDiscussion[id] = window.setTimeout(() => {\n    const toSend = pendingCandidateByDiscussion[id];\n    if (typeof toSend !== 'number' || toSend <= 0) return;\n\n    const current = discussion.attribute('lbReadingPosition') ?? 0;\n    const lastCommitted = lastCommittedByDiscussion[id] ?? current;\n    if (toSend === current || toSend === lastCommitted) return;\n\n    savePosition(id, toSend).then(() => {\n      lastCommittedByDiscussion[id] = toSend;\n      if (discussion.attribute('lbReadingPosition') !== toSend) {\n        discussion.pushAttributes({ lbReadingPosition: toSend });\n      }\n    });\n  }, DEBOUNCE_MS);\n}\n\n/** =================== 原插件：列表项改写（不处理搜索页） =================== */\napp.initializers.add('lady-byron/reading-enhance', () => {\n  extend(DiscussionListItem.prototype, 'view', function (vdom: any) {\n    // 按既有逻辑：搜索页（params.q）不改写，保留“最相关”体验；全局兜底会覆盖其它来源\n    if ((this as any).attrs?.params?.q) return;\n\n    const discussion = (this as any).attrs?.discussion;\n    if (!discussion) return;\n\n    const recorded: number | null = discussion.attribute('lbReadingPosition') ?? null;\n    if (!recorded || recorded <= 1) return;\n\n    (vdom.children as any[]).forEach((child: any) => {\n      if (\n        !child ||\n        !child.attrs ||\n        !child.attrs.className ||\n        child.attrs.className.indexOf('DiscussionListItem-content') === -1\n      ) {\n        return;\n      }\n\n      (child.children as any[]).forEach((sub: any) => {\n        if (!sub || sub.tag !== Link) return;\n\n        let href: string;\n        if (shouldRedirectDiscussionToBlog(discussion)) {\n          href =\n            recorded > 1\n              ? app.route('blogArticle.near', { id: discussion.slug(), near: recorded })\n              : app.route('blogArticle', { id: discussion.slug() });\n        } else {\n          href = app.route.discussion(discussion, recorded);\n        }\n\n        sub.attrs.href = href;\n      });\n    });\n  });\n\n  /** ========== 原插件：阅读页实时写库（双向，200ms 合并） ========== */\n  override(DiscussionPage.prototype, 'view', function (original: any, ...args: any[]) {\n    const vdom = original(...args);\n\n    const inject = (node: any) => {\n      if (!node) return;\n      if (Array.isArray(node)) return node.forEach(inject);\n      if (node.children) inject(node.children);\n\n      if (node.tag === PostStream) {\n        node.attrs = node.attrs || {};\n        const prev = node.attrs.onPositionChange;\n\n        node.attrs.onPositionChange = (...cbArgs: any[]) => {\n          if (typeof prev === 'function') prev(...cbArgs);\n          if (!app.session.user) return;\n\n          const dp = this as any;\n          const discussion = dp?.discussion;\n          if (!discussion) return;\n\n          let n = derivePostNumberFromPositionChangeArgs(cbArgs);\n          if (!n) n = extractNearFromUrl();\n          if (!n) n = extractTopPartiallyVisible();\n\n          if (n && typeof n === 'number' && n > 0) {\n            scheduleSaveBidirectional(discussion, n);\n          }\n        };\n      }\n    };\n\n    inject(vdom);\n    return vdom;\n  });\n\n  /** =================== 全局兜底优化 =================== */\n\n  // —— 缓存：id → near\n  const nearCache: Map<string, number> = new Map();\n\n  function sameOrigin(u: URL): boolean {\n    try {\n      const base = new URL(app.forum.attribute('baseUrl'));\n      return u.origin === base.origin;\n    } catch {\n      return false;\n    }\n  }\n\n  function parseDiscussionIdFromUrl(u: URL): string | null {\n    const parts = u.pathname.split('/').filter(Boolean);\n    const dIndex = parts.indexOf('d');\n    if (dIndex === -1 || parts.length <= dIndex + 1) return null;\n    const idPart = parts[dIndex + 1];\n    const match = /^(\\d+)/.exec(idPart);\n    return match ? match[1] : null;\n  }\n\n  function hasExplicitNear(u: URL): number | null {\n    const parts = u.pathname.split('/').filter(Boolean);\n    const dIndex = parts.indexOf('d');\n    if (dIndex !== -1 && parts.length > dIndex + 2) {\n      const n = parseInt(parts[dIndex + 2], 10);\n      if (!Number.isNaN(n) && n > 0) return n;\n    }\n    const qNear = parseInt(u.searchParams.get('near') || '', 10);\n    if (!Number.isNaN(qNear) && qNear > 0) return qNear;\n    if (u.hash && /^#p\\d+$/i.test(u.hash)) {\n      const n = parseInt(u.hash.slice(2), 10);\n      if (!Number.isNaN(n) && n > 0) return n;\n    }\n    return null;\n  }\n\n  function buildNearUrl(u: URL, near: number): string {\n    const parts = u.pathname.split('/').filter(Boolean);\n    const dIndex = parts.indexOf('d');\n    const prefix = '/' + parts.slice(0, dIndex + 2).join('/');\n    u.pathname = `${prefix}/${near}`;\n    u.searchParams.delete('near');\n    if (u.hash && /^#p\\d+$/i.test(u.hash)) u.hash = '';\n    return u.pathname + u.search + u.hash;\n  }\n\n  function nearFromStore(id: string): number | null {\n    const d = app.store.getById('discussions', id);\n    if (!d) return null;\n    const lb = d.attribute && d.attribute('lbReadingPosition');\n    const last =\n      typeof d.lastReadPostNumber === 'function'\n        ? d.lastReadPostNumber()\n        : d.attribute && d.attribute('lastReadPostNumber');\n    return typeof lb === 'number' && lb > 1\n      ? lb\n      : typeof last === 'number' && last > 1\n      ? last\n      : null;\n  }\n\n  async function nearFromApi(id: string): Promise<number | null> {\n    try {\n      const res: any = await app.request({\n        method: 'GET',\n        url: `${app.forum.attribute('apiUrl')}/discussions/${id}`,\n        params: {\n          'fields[discussions]': 'title,slug,lastReadPostNumber,lbReadingPosition',\n        },\n      });\n      const attrs = res?.data?.attributes || {};\n      const lb =\n        typeof attrs.lbReadingPosition === 'number' ? attrs.lbReadingPosition : null;\n      const last =\n        typeof attrs.lastReadPostNumber === 'number'\n          ? attrs.lastReadPostNumber\n          : null;\n      return (lb && lb > 1) ? lb : (last && last > 1 ? last : null);\n    } catch {\n      return null;\n    }\n  }\n\n  /** 悬停：可重复刷新 near（为了左下角预览更准） */\n  const hoverTimers = new WeakMap<EventTarget, number>();\n\n  function findAnchor(target: EventTarget | null): HTMLAnchorElement | null {\n    let el = target as HTMLElement | null;\n    while (el && el !== document.body) {\n      if (el instanceof HTMLAnchorElement) return el;\n      el = el.parentElement;\n    }\n    return null;\n  }\n\n  document.addEventListener(\n    'mouseover',\n    (e) => {\n      const a = findAnchor(e.target);\n      if (!a) return;\n\n      const t = window.setTimeout(async () => {\n        try {\n          const u = new URL(a.href, window.location.href);\n          if (!sameOrigin(u)) return;\n\n          const explicit = hasExplicitNear(u);\n          if (explicit) return; // 已显式 near，无需改\n\n          const id = parseDiscussionIdFromUrl(u);\n          if (!id) return;\n\n          let near = nearCache.get(id) ?? nearFromStore(id);\n          if (!near) {\n            near = await nearFromApi(id);\n            if (near) nearCache.set(id, near);\n          }\n          if (near && near > 1) {\n            const prev = a.dataset.lbRewrittenNear\n              ? parseInt(a.dataset.lbRewrittenNear, 10)\n              : null;\n            if (prev !== near) {\n              a.href = buildNearUrl(u, near);\n              a.dataset.lbRewritten = '1';\n              a.dataset.lbRewrittenNear = String(near);\n            }\n          }\n        } catch {}\n      }, 120);\n\n      hoverTimers.set(a, t);\n    },\n    { passive: true }\n  );\n\n  document.addEventListener(\n    'mouseout',\n    (e) => {\n      const a = findAnchor(e.target);\n      if (!a) return;\n      const t = hoverTimers.get(a);\n      if (t) {\n        window.clearTimeout(t);\n        hoverTimers.delete(a);\n      }\n    },\n    { passive: true }\n  );\n\n  /** 点击接管：无论是否已有 near，都在捕获阶段阻断，再由我们导航到“最终 URL” */\n  document.addEventListener(\n    'click',\n    (e) => {\n      const a = findAnchor(e.target);\n      if (!a) return;\n\n      let u: URL;\n      try {\n        u = new URL(a.href, window.location.href);\n      } catch {\n        return;\n      }\n      if (!sameOrigin(u)) return;\n\n      const id = parseDiscussionIdFromUrl(u);\n      if (!id) return; // 只接管 /d/… 讨论链接\n\n      // 阻断后续所有处理，防止容器自己 m.route.set('/d/:id') 覆盖 near\n      e.preventDefault();\n      // @ts-ignore\n      if (e.stopImmediatePropagation) e.stopImmediatePropagation();\n\n      (async () => {\n        // 1) 若链接本身已有 near → 直接用（我们来发起导航，避免被覆盖）\n        let near = hasExplicitNear(u);\n\n        // 2) 否则按 lb > last 求 near（先缓存/模型，再必要时请求 API）\n        if (!near) near = nearCache.get(id) ?? nearFromStore(id);\n        if (!near) {\n          near = await nearFromApi(id);\n          if (near) nearCache.set(id, near);\n        }\n\n        const target =\n          near && near > 1 ? buildNearUrl(u, near) : u.pathname + u.search + u.hash;\n\n        // 统一由我们导航，确保 near 不被覆盖\n        // @ts-ignore\n        return m.route.set(target);\n      })().catch(() => {\n        // 失败时用原始 href 兜底\n        // @ts-ignore\n        m.route.set(a.getAttribute('href')!);\n      });\n    },\n    { capture: true }\n  );\n\n  /** 兜底补丁：任何地方调用 m.route.set('/d/:id') 时，如果我们有 near，就补成 '/:near' */\n  // @ts-ignore\n  const oldSet = m.route.set.bind(m.route);\n  // @ts-ignore\n  m.route.set = function (path: string, data?: any, options?: any) {\n    try {\n      const url = new URL(path, window.location.origin);\n      const parts = url.pathname.split('/').filter(Boolean);\n      const dIndex = parts.indexOf('d');\n      if (dIndex !== -1 && parts.length > dIndex + 1) {\n        const hasNearPath = parts.length > dIndex + 2 && /^\\d+$/.test(parts[dIndex + 2]);\n        const hasNearQuery = url.searchParams.has('near');\n        if (!hasNearPath && !hasNearQuery) {\n          const idPart = parts[dIndex + 1];\n          const idMatch = /^(\\d+)/.exec(idPart);\n          const id = idMatch ? idMatch[1] : null;\n          if (id) {\n            const near = nearFromStore(id);\n            if (near && near > 1) {\n              const prefix = '/' + parts.slice(0, dIndex + 2).join('/');\n              url.pathname = `${prefix}/${near}`;\n              url.searchParams.delete('near');\n              path = url.pathname + url.search + url.hash;\n            }\n          }\n        }\n      }\n    } catch {}\n    // @ts-ignore\n    return oldSet(path, data, options);\n  };\n});\n"],"names":["OverloadYield","require","regenerator","regeneratorAsync","regeneratorAsyncGen","regeneratorAsyncIterator","regeneratorKeys","regeneratorValues","_regeneratorRuntime","r","e","m","t","Object","getPrototypeOf","__proto__","constructor","n","displayName","name","o","a","stop","v","abrupt","delegateYield","resultName","d","finish","f","_t","p","prev","next","sent","call","this","module","exports","wrap","w","reverse","isGeneratorFunction","mark","awrap","AsyncIterator","async","u","keys","values","__esModule","regeneratorDefine","_regenerator","Symbol","iterator","toStringTag","i","c","prototype","Generator","create","y","G","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","setPrototypeOf","k","resolve","then","asyncIterator","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","Promise","_regeneratorDefine","defineProperty","_invoke","enumerable","configurable","writable","_typeof","isNaN","unshift","pop","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","definition","key","get","obj","prop","hasOwnProperty","asyncGeneratorStep","_asyncToGenerator","arguments","apply","_next","_throw","flarum","core","compat","pendingTimerByDiscussion","pendingCandidateByDiscussion","lastCommittedByDiscussion","app","add","extend","DiscussionListItem","vdom","_attrs","_attrs2","_discussion$attribute2","attrs","params","q","discussion","recorded","attribute","children","forEach","child","className","indexOf","sub","href","tag","Link","extensions","redirects","discussionRedirectEnabled","tags","blogTags","some","parent","id","shouldRedirectDiscussionToBlog","slug","near","override","DiscussionPage","original","_this","_len","args","Array","_key","inject","node","isArray","PostStream","onPositionChange","_len2","cbArgs","_key2","user","_step","_iterator","_createForOfIteratorHelperLoose","number","postNumber","visible","derivePostNumberFromPositionChangeArgs","url","URL","window","location","parts","pathname","split","filter","Boolean","dIndex","maybeNear","parseInt","Number","qNear","searchParams","_unused","extractNearFromUrl","items","document","querySelectorAll","_i","_Array$from","from","el","rect","getBoundingClientRect","top","bottom","dataset","_i2","_Array$from2","innerHeight","extractTopPartiallyVisible","candidate","clearTimeout","setTimeout","_discussion$attribute","_lastCommittedByDiscu","toSend","discussionId","current","lastCommitted","method","body","pushAttributes","lbReadingPosition","scheduleSaveBidirectional","nearCache","Map","sameOrigin","base","origin","_unused2","parseDiscussionIdFromUrl","idPart","match","exec","hasExplicitNear","hash","test","slice","buildNearUrl","prefix","join","search","nearFromStore","getById","lb","last","lastReadPostNumber","nearFromApi","_x","_nearFromApi","_callee3","_res$data","res","_context3","data","attributes","hoverTimers","WeakMap","findAnchor","target","HTMLAnchorElement","parentElement","addEventListener","_callee","_nearCache$get","_context","set","lbRewrittenNear","lbRewritten","String","passive","_unused4","preventDefault","stopImmediatePropagation","_callee2","_nearCache$get2","_context2","route","getAttribute","capture","oldSet","path","options","hasNearPath","hasNearQuery","has","idMatch","_unused5"],"sourceRoot":""}