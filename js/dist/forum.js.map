{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regenerator.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/OverloadYield.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/regenerator/index.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorDefine.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/typeof.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorValues.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorKeys.js","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/regeneratorAsync.js","webpack://@lady-byron/reading-enhance-js/webpack/bootstrap","webpack://@lady-byron/reading-enhance-js/webpack/runtime/compat get default export","webpack://@lady-byron/reading-enhance-js/webpack/runtime/define property getters","webpack://@lady-byron/reading-enhance-js/webpack/runtime/hasOwnProperty shorthand","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/app']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/states/PostStreamState']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@lady-byron/reading-enhance-js/./src/forum/features/replyJumpInterceptor.ts","webpack://@lady-byron/reading-enhance-js/./src/forum/features/readingShortcuts.ts","webpack://@lady-byron/reading-enhance-js/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['common/extend']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@lady-byron/reading-enhance-js/external root \"flarum.core.compat['common/components/Link']\"","webpack://@lady-byron/reading-enhance-js/./src/forum/features/smartJump.ts","webpack://@lady-byron/reading-enhance-js/./src/forum/index.ts"],"sourcesContent":["var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/PostStreamState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","// js/src/forum/features/replyJumpInterceptor.ts\nimport app from 'flarum/forum/app';\nimport PostStreamState from 'flarum/forum/states/PostStreamState';\nimport PostStream from 'flarum/forum/components/PostStream';\n\n/**\n * 精确令牌拦截：\n * - 仅在“提交新回复成功（POST /posts）”后，给对应讨论 did 上一次性令牌（可消费 2~3 次滚动入口）。\n * - 在 goToNumber('reply') / scrollToNumber(newNumber) / triggerScroll等入口，命中当前讨论且目标=回复/末楼时吞掉滚动。\n * - 不影响 near 跳转、点楼号、路由初始定位等其它行为。\n */\n\ntype Token = {\n  did: string | null;\n  targetNum: number | null; // 新回复的楼号（来自 POST /posts 响应）\n  left: number;             // 可吞次数（冗余入口链路下通常 2~3 次足够）\n  expiresAt: number;        // TTL，毫秒级\n};\n\nconst token: Token = {\n  did: null,\n  targetNum: null,\n  left: 0,\n  expiresAt: 0,\n};\n\nfunction now() {\n  return Date.now();\n}\nfunction activeFor(did: string | null): boolean {\n  return (\n    !!did &&\n    token.did === did &&\n    token.left > 0 &&\n    now() < token.expiresAt\n  );\n}\nfunction arm(did: string, targetNum: number | null, ttlMs = 1800, times = 3) {\n  token.did = did;\n  token.targetNum = typeof targetNum === 'number' && targetNum > 0 ? targetNum : null;\n  token.left = Math.max(1, times);\n  token.expiresAt = now() + Math.max(300, ttlMs);\n}\nfunction consume() {\n  if (token.left > 0) token.left -= 1;\n  if (token.left <= 0) {\n    token.did = null;\n    token.targetNum = null;\n    token.expiresAt = 0;\n  }\n}\n\nfunction isReplyJump(discussion: any, target: 'reply' | number | any): boolean {\n  // 仅判断“发帖后滚动到底部/新楼”的特征\n  if (!discussion) return false;\n\n  if (target === 'reply') return true;\n\n  const last: number | null =\n    typeof discussion.lastPostNumber === 'function'\n      ? discussion.lastPostNumber()\n      : discussion.attribute?.('lastPostNumber');\n\n  if (typeof target === 'number' && target > 0) {\n    // 目标是“末楼或更后”（保守 ≥）\n    if (typeof last === 'number' && last > 0 && target >= last) return true;\n    // 若有 POST 返回的确切新楼号，用它作判定更稳\n    if (token.targetNum && target >= token.targetNum) return true;\n  }\n\n  return false;\n}\n\nfunction installRequestHook() {\n  // 只包一次\n  if ((app as any).__lbReqHooked) return;\n  (app as any).__lbReqHooked = true;\n\n  const orig = app.request.bind(app);\n\n  app.request = function (opts: any) {\n    const p = orig(opts);\n    try {\n      const method = String(opts?.method || '').toUpperCase();\n      const url = String(opts?.url || '');\n      const isCreatePost =\n        method === 'POST' &&\n        /\\/posts(?:\\?|$|\\/)/.test(url); // .../api/posts\n\n      if (!isCreatePost) return p;\n\n      return p.then((res: any) => {\n        // 解析 discussionId 与新楼号\n        const did =\n          res?.data?.relationships?.discussion?.data?.id ??\n          res?.data?.attributes?.discussionId ??\n          null;\n        const num: number | null =\n          typeof res?.data?.attributes?.number === 'number'\n            ? res.data.attributes.number\n            : null;\n\n        if (did) {\n          arm(String(did), num, 1800, 3);\n        }\n        return res;\n      });\n    } catch {\n      // 出错不影响请求链路\n      return p;\n    }\n  };\n}\n\nfunction installScrollGuards() {\n  // --- goToNumber(entry)：最早的定位入口 ---\n  const goToOrig = (PostStreamState as any).prototype.goToNumber;\n  (PostStreamState as any).prototype.goToNumber = function (target: any, ...rest: any[]) {\n    try {\n      const discussion = (this as any)?.discussion;\n      const did =\n        discussion?.id?.() ??\n        (typeof discussion?.id === 'function' ? discussion.id() : null);\n\n      if (activeFor(did) && isReplyJump(discussion, target)) {\n        consume();\n        return; // 吞掉这一次“发帖后自动滚动”\n      }\n    } catch {}\n    return goToOrig.apply(this, [target, ...rest]);\n  };\n\n  // --- PostStream.prototype.triggerScroll：滚动触发（适配不同核心版本） ---\n  const psProto: any = (PostStream as any).prototype;\n\n  if (typeof psProto.triggerScroll === 'function') {\n    const trigOrig = psProto.triggerScroll;\n    psProto.triggerScroll = function (...args: any[]) {\n      try {\n        const state = this?.attrs?.state;\n        const discussion = state?.discussion;\n        const did =\n          discussion?.id?.() ??\n          (typeof discussion?.id === 'function' ? discussion.id() : null);\n        const target =\n          state?.targetPostNumber ??\n          state?.index ??\n          (state?.visible && state.visible.number) ??\n          null;\n\n        if (activeFor(did) && isReplyJump(discussion, target)) {\n          consume();\n          return;\n        }\n      } catch {}\n      return trigOrig.apply(this, args);\n    };\n  }\n\n  // --- PostStream.prototype.scrollToNumber：另一实现路径 ---\n  if (typeof psProto.scrollToNumber === 'function') {\n    const toNumOrig = psProto.scrollToNumber;\n    psProto.scrollToNumber = function (n: number, ...rest: any[]) {\n      try {\n        const state = this?.attrs?.state;\n        const discussion = state?.discussion;\n        const did =\n          discussion?.id?.() ??\n          (typeof discussion?.id === 'function' ? discussion.id() : null);\n\n        if (activeFor(did) && isReplyJump(discussion, n)) {\n          consume();\n          return;\n        }\n      } catch {}\n      return toNumOrig.apply(this, [n, ...rest]);\n    };\n  }\n\n  // --- PostStream.prototype.scrollToIndex：极少数路径（保守） ---\n  if (typeof psProto.scrollToIndex === 'function') {\n    const toIdxOrig = psProto.scrollToIndex;\n    psProto.scrollToIndex = function (i: number, ...rest: any[]) {\n      try {\n        const state = this?.attrs?.state;\n        const discussion = state?.discussion;\n        const did =\n          discussion?.id?.() ??\n          (typeof discussion?.id === 'function' ? discussion.id() : null);\n        const approxTarget =\n          state?.visible?.number && typeof state.visible.number === 'number'\n            ? state.visible.number\n            : i;\n\n        if (activeFor(did) && isReplyJump(discussion, approxTarget)) {\n          consume();\n          return;\n        }\n      } catch {}\n      return toIdxOrig.apply(this, [i, ...rest]);\n    };\n  }\n}\n\nexport default function installReplyJumpInterceptor() {\n  app.initializers.add('lady-byron/reading-enhance-reply-jump', () => {\n    // 1) 监听“发帖成功”\n    installRequestHook();\n\n    // 2) 拦截“仅限由发帖引发的滚动”\n    installScrollGuards();\n  });\n}\n","// js/src/forum/features/readingShortcuts.ts\nimport app from 'flarum/forum/app';\n\n/**\n * 半屏/整屏翻页快捷键（桌面端优先）\n * - Shift+D  半屏下\n * - Shift+U  半屏上\n * - Shift+J  整屏下\n * - Shift+K  整屏上\n *\n * 仅在非输入/编辑状态触发；不影响弹窗、编辑器、Composer。\n */\n\ntype Options = {\n  halfRatio: number;       // 半屏比例\n  smooth: boolean;         // 是否平滑滚动\n  headerSelector: string;  // 顶栏选择器，用于抵扣可视高度\n};\n\nconst DEFAULTS: Options = {\n  halfRatio: 0.5,\n  smooth: true,\n  headerSelector: '.App-header',\n};\n\nfunction isEditableTarget(t: EventTarget | null): boolean {\n  const el = t instanceof Element ? t : null;\n  if (!el) return false;\n\n  // 常见可编辑/输入容器\n  const editable = el.closest(\n    'input, textarea, [contenteditable=\"true\"], .TextEditor, .CodeMirror, .ProseMirror, .Composer, .Modal'\n  );\n  // Composer 打开时整体禁用\n  const composerOpen = !!(app as any)?.composer?.isVisible?.();\n\n  return !!editable || composerOpen;\n}\n\nfunction headerOffsetPx(sel: string): number {\n  try {\n    const h = document.querySelector(sel);\n    return h ? h.getBoundingClientRect().height : 0;\n  } catch {\n    return 0;\n  }\n}\n\nfunction scrollByAmount(px: number, smooth: boolean) {\n  if ('scrollBy' in window) {\n    window.scrollBy({ top: px, left: 0, behavior: smooth ? 'smooth' : 'auto' });\n  } else {\n    const sc = document.scrollingElement || document.documentElement || document.body;\n    sc.scrollTop += px;\n  }\n}\n\nfunction keySig(e: KeyboardEvent): string {\n  // 只关心 Shift + 字母，不处理 Ctrl/Meta/Alt，避免系统/浏览器冲突\n  if (e.ctrlKey || e.metaKey || e.altKey) return '';\n  const parts: string[] = [];\n  if (e.shiftKey) parts.push('Shift');\n  const k = e.key.length === 1 ? e.key.toUpperCase() : e.key;\n  parts.push(k);\n  return parts.join('+');\n}\n\nexport default function installReadingShortcuts(opts?: Partial<Options>) {\n  const options: Options = Object.assign({}, DEFAULTS, opts || {});\n  let attached = false;\n\n  app.initializers.add('lady-byron/reading-enhance-shortcuts', () => {\n    if (attached) return;\n    attached = true;\n\n    const onKeydown = (e: KeyboardEvent) => {\n      // 在输入/编辑/弹窗内不触发；忽略按住不放的连发\n      if (isEditableTarget(e.target) || e.repeat) return;\n\n      const sig = keySig(e);\n      if (!sig) return;\n\n      const offset = headerOffsetPx(options.headerSelector);\n      const vh = window.innerHeight || 0;\n\n      switch (sig) {\n        case 'Shift+D': {\n          e.preventDefault(); e.stopPropagation();\n          const delta = Math.max(1, Math.round(vh * options.halfRatio) - Math.round(offset / 2));\n          scrollByAmount(delta, options.smooth);\n          break;\n        }\n        case 'Shift+U': {\n          e.preventDefault(); e.stopPropagation();\n          const delta = Math.max(1, Math.round(vh * options.halfRatio) - Math.round(offset / 2));\n          scrollByAmount(-delta, options.smooth);\n          break;\n        }\n        case 'Shift+J': {\n          e.preventDefault(); e.stopPropagation();\n          scrollByAmount(vh, options.smooth);\n          break;\n        }\n        case 'Shift+K': {\n          e.preventDefault(); e.stopPropagation();\n          scrollByAmount(-vh, options.smooth);\n          break;\n        }\n        default:\n          // 其它组合不处理\n          break;\n      }\n    };\n\n    // 捕获阶段优先处理，但不干扰其它键位\n    window.addEventListener('keydown', onKeydown, true);\n\n    // 若未来需要卸载，可暴露到全局（调试用）\n    (window as any).__lb_shortcuts = {\n      detach() {\n        window.removeEventListener('keydown', onKeydown, true);\n      },\n    };\n  });\n}\n","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport Link from 'flarum/common/components/Link';\n\n/**\n * ===========================================================================\n * Helper Functions: 工具函数与逻辑判断\n * ===========================================================================\n */\n\n// 解析 URL 中的 ID\nfunction getDiscussionId(urlStr: string): string | null {\n  try {\n    const u = new URL(urlStr, window.location.origin);\n    if (u.origin !== window.location.origin) return null;\n    const match = u.pathname.match(/\\/d\\/(\\d+)/);\n    return match ? match[1] : null;\n  } catch { return null; }\n}\n\n// 判断是否包含显式楼层意图\nfunction hasExplicitNear(urlStr: string): boolean {\n  try {\n    const u = new URL(urlStr, window.location.origin);\n    if (u.pathname.split('/').filter(Boolean).length > 2) return true;\n    if (u.searchParams.has('near')) return true;\n    if (u.hash) return true;\n  } catch {}\n  return false;\n}\n\n// 兼容 v17-blog 插件\nfunction shouldRedirectDiscussionToBlog(discussion: any): boolean {\n  // @ts-ignore\n  if (!('v17development-blog' in flarum.extensions)) return false;\n  const redirects = app.forum.attribute('blogRedirectsEnabled');\n  const discussionRedirectEnabled = redirects === 'both' || redirects === 'discussions_only';\n  const tags = discussion.tags?.() || [];\n  if (!discussionRedirectEnabled || tags.length === 0) return false;\n  const blogTags = app.forum.attribute<string[]>('blogTags') || [];\n  return tags.some((tag: any) => {\n    if (!tag) return false;\n    const parent = tag.parent?.() || null;\n    return (\n      blogTags.indexOf(tag.id?.()!) !== -1 ||\n      (parent && blogTags.indexOf(parent.id?.()!) !== -1)\n    );\n  });\n}\n\n/**\n * ===========================================================================\n * Data Layer: 数据预热与获取\n * ===========================================================================\n */\n\nconst pendingRequests = new Map<string, Promise<void>>();\n\nasync function ensurePosition(id: string): Promise<void> {\n  // 1. 检查 Store\n  const d = app.store.getById('discussions', id);\n  // 只有当 slug 存在（确保能生成路由）且 readingPosition 存在时，才算命中\n  if (d && d.slug() && d.attribute('lbReadingPosition') !== undefined) return;\n\n  // 2. 检查是否正在请求中\n  if (pendingRequests.has(id)) return pendingRequests.get(id);\n\n  // 3. 发起静默请求\n  const promise = app.request<any>({\n    method: 'GET',\n    url: `${app.forum.attribute('apiUrl')}/discussions/${id}`,\n    // 【修复点】必须请求 slug，否则新加载的帖子对象无法生成路由！\n    // 同时请求 title 虽然不是必须的，但有助于完善 store 数据\n    params: { 'fields[discussions]': 'slug,title,lbReadingPosition,lastReadPostNumber' },\n    background: true,\n  }).then((res) => {\n    app.store.pushPayload(res);\n  }).finally(() => {\n    pendingRequests.delete(id);\n  });\n\n  pendingRequests.set(id, promise);\n  return promise;\n}\n\nfunction resolveTarget(id: string): number | null {\n  const d = app.store.getById('discussions', id);\n  if (!d) return null;\n\n  const lb = d.attribute('lbReadingPosition');\n  if (typeof lb === 'number' && lb > 1) return lb;\n\n  const last = d.lastReadPostNumber();\n  if (typeof last === 'number' && last > 1) return last;\n\n  return null;\n}\n\n/**\n * ===========================================================================\n * Main Install Function\n * ===========================================================================\n */\nexport default function installSmartJump() {\n  \n  // 1. 视口预加载器\n  const observer = new IntersectionObserver((entries) => {\n    entries.forEach((entry) => {\n      if (entry.isIntersecting) {\n        const a = entry.target as HTMLAnchorElement;\n        const id = getDiscussionId(a.href);\n        if (id) ensurePosition(id);\n        observer.unobserve(a);\n      }\n    });\n  }, { rootMargin: '100px' });\n\n  const scanLinks = () => {\n    document.querySelectorAll('a[href^=\"/d/\"]:not([data-lb-obs])').forEach((el) => {\n      if (el.closest('.PostStreamScrubber, .Scrubber')) return;\n      observer.observe(el);\n      el.setAttribute('data-lb-obs', '1');\n    });\n  };\n\n  extend(app, 'mount', scanLinks);\n  extend(app, 'update', scanLinks);\n\n  // 2. 列表视图重写 (Visual Rewrite)\n  extend(DiscussionListItem.prototype, 'view', function (vdom: any) {\n    if (this.attrs?.params?.q) return;\n    const discussion = this.attrs?.discussion;\n    if (!discussion) return;\n\n    const targetNear = resolveTarget(discussion.id());\n    if (!targetNear) return;\n\n    const injectHref = (node: any) => {\n        if (!node) return;\n        if (Array.isArray(node)) return node.forEach(injectHref);\n        if (node.tag === Link && node.attrs?.href) {\n             if (node.attrs.className && node.attrs.className.includes('DiscussionListItem-count')) return;\n             \n             let newHref = '';\n             if (shouldRedirectDiscussionToBlog(discussion)) {\n                 newHref = app.route('blogArticle.near', { id: discussion.slug(), near: targetNear });\n             } else {\n                 newHref = app.route.discussion(discussion, targetNear);\n             }\n             node.attrs.href = newHref;\n        }\n        if (node.children) injectHref(node.children);\n    };\n    injectHref(vdom);\n  });\n\n  // 3. 点击拦截器 (Click Interceptor)\n  document.addEventListener('click', async (e) => {\n    const a = (e.target as HTMLElement).closest('a');\n    if (!a) return;\n    if (a.closest('.PostStreamScrubber, .Scrubber')) return;\n\n    const id = getDiscussionId(a.href);\n    if (!id) return;\n\n    if (hasExplicitNear(a.href)) return;\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    a.classList.add('lb-loading-jump');\n\n    try {\n      await ensurePosition(id);\n\n      const d = app.store.getById('discussions', id);\n      const target = resolveTarget(id);\n\n      a.classList.remove('lb-loading-jump');\n\n      if (target && d && d.slug()) { // 确保有 slug 才能跳\n        if (shouldRedirectDiscussionToBlog(d)) {\n             m.route.set(app.route('blogArticle.near', { id: d.slug(), near: target }));\n        } else {\n             m.route.set(app.route.discussion(d, target));\n        }\n      } else if (target && d) {\n        // 【安全兜底】如果有 target 但没 slug (极罕见)，手动拼 ID 链接\n        // 这能防止 undefined 错误\n        m.route.set(`/d/${id}/${target}`);\n      } else {\n        // 兜底：未读过，跳原始链接\n        const u = new URL(a.href, window.location.origin);\n        m.route.set(u.pathname + u.search + u.hash);\n      }\n    } catch (err) {\n      console.error(err);\n      a.classList.remove('lb-loading-jump');\n      const href = a.getAttribute('href');\n      if (href) m.route.set(href);\n    }\n  }, { capture: true });\n}\n","// js/src/forum/index.ts\nimport app from 'flarum/forum/app';\n\n// 导入我们拆分出来的三个功能模块\nimport installReplyJumpInterceptor from './features/replyJumpInterceptor';\nimport installReadingShortcuts from './features/readingShortcuts';\nimport installSmartJump from './features/smartJump'; // 这是刚才新建的核心逻辑文件\n\napp.initializers.add('lady-byron/reading-enhance', () => {\n  // 1. 安装“发帖后自动跳尾抑制” (原有功能，已模块化)\n  installReplyJumpInterceptor();\n\n  // 2. 安装“阅读快捷键：Shift+D/U/J/K” (原有功能，已模块化)\n  installReadingShortcuts();\n\n  // 3. 安装“智能跳转” (新功能：视口预加载 + 点击拦截 + 加载UI)\n  // 注意：这里不再有原来的 mouseover 逻辑，全部移交给 smartJump 处理了\n  installSmartJump();\n});\n"],"names":["OverloadYield","require","regenerator","regeneratorAsync","regeneratorAsyncGen","regeneratorAsyncIterator","regeneratorKeys","regeneratorValues","_regeneratorRuntime","r","e","m","t","Object","getPrototypeOf","__proto__","constructor","n","displayName","name","o","a","stop","v","abrupt","delegateYield","resultName","d","finish","f","_t","p","prev","next","sent","call","this","module","exports","wrap","w","reverse","isGeneratorFunction","mark","awrap","AsyncIterator","async","u","keys","values","__esModule","regeneratorDefine","_regenerator","Symbol","iterator","toStringTag","i","c","prototype","Generator","create","y","G","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","setPrototypeOf","k","resolve","then","asyncIterator","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","Promise","_regeneratorDefine","defineProperty","_invoke","enumerable","configurable","writable","_typeof","isNaN","unshift","pop","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","definition","key","get","obj","prop","hasOwnProperty","flarum","core","compat","token","did","targetNum","left","expiresAt","now","Date","activeFor","consume","isReplyJump","discussion","target","last","lastPostNumber","attribute","installReplyJumpInterceptor","app","add","orig","opts","method","String","toUpperCase","url","test","res","_ref","_res$data$relationshi","_res$data","_res$data2","_res$data3","data","relationships","id","attributes","discussionId","num","number","ttlMs","times","Math","max","arm","_unused","installRequestHook","goToOrig","PostStreamState","goToNumber","_discussion$id","_unused2","_len","arguments","rest","Array","_key","apply","concat","psProto","PostStream","triggerScroll","trigOrig","_this$attrs","_discussion$id2","_ref2","_ref3","_state$targetPostNumb","state","attrs","targetPostNumber","index","visible","_unused3","_len2","args","_key2","scrollToNumber","toNumOrig","_this$attrs2","_discussion$id3","_unused4","_len3","_key3","scrollToIndex","toIdxOrig","_this$attrs3","_discussion$id4","_state$visible","approxTarget","_unused5","_len4","_key4","installScrollGuards","DEFAULTS","halfRatio","smooth","headerSelector","scrollByAmount","px","window","scrollBy","top","behavior","document","scrollingElement","documentElement","body","scrollTop","asyncGeneratorStep","_asyncToGenerator","_next","_throw","getDiscussionId","urlStr","URL","location","origin","match","pathname","hasExplicitNear","split","filter","Boolean","searchParams","has","hash","shouldRedirectDiscussionToBlog","extensions","redirects","discussionRedirectEnabled","tags","blogTags","some","tag","parent","indexOf","pendingRequests","Map","ensurePosition","_x","_ensurePosition","_callee2","promise","_context2","getById","slug","params","background","pushPayload","set","resolveTarget","lb","lastReadPostNumber","observer","scanLinks","options","attached","assign","onKeydown","_composer","el","Element","editable","closest","composerOpen","isVisible","isEditableTarget","repeat","sig","ctrlKey","metaKey","altKey","parts","shiftKey","push","join","keySig","offset","sel","h","querySelector","getBoundingClientRect","height","headerOffsetPx","vh","innerHeight","preventDefault","stopPropagation","round","addEventListener","__lb_shortcuts","detach","removeEventListener","IntersectionObserver","entries","forEach","entry","isIntersecting","href","unobserve","rootMargin","querySelectorAll","observe","setAttribute","extend","DiscussionListItem","vdom","q","targetNear","injectHref","node","_node$attrs","isArray","Link","className","includes","newHref","near","children","_callee","_context","classList","remove","route","search","console","error","getAttribute","_x2","capture"],"ignoreList":[],"sourceRoot":""}